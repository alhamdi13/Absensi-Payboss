<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PayBoss - Sistem Absensi</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        * {
            box-sizing: border-box;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        .camera-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        #video, #canvas {
            width: 100%;
            height: auto;
            border-radius: 12px;
        }

        .overlay-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70%;
            height: 0;
            padding-bottom: 70%;
            border: 3px dashed rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
        }

        .grid-photo {
            aspect-ratio: 1;
            object-fit: cover;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .status-hadir {
            background-color: #dcfce7;
            color: #166534;
        }

        .status-terlambat {
            background-color: #fef3c7;
            color: #92400e;
        }

        .status-tidak-sesuai {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .shift-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
        }

        .shift-1 {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .shift-2 {
            background-color: #fef3c7;
            color: #92400e;
        }

        .shift-3 {
            background-color: #e0e7ff;
            color: #3730a3;
        }

        .shift-off {
            background-color: #f1f5f9;
            color: #64748b;
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .btn-primary {
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            transform: scale(1.02);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        #canvas {
            display: none;
        }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            padding: 4px;
            font-size: 12px;
            min-height: 60px;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }

        .calendar-header-day {
            text-align: center;
            font-weight: 600;
            padding: 8px 4px;
            font-size: 14px;
        }

        .roster-grid {
            display: grid;
            grid-template-columns: 150px repeat(7, 1fr);
            gap: 2px;
            font-size: 12px;
        }

        .roster-name {
            padding: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            border-radius: 6px;
        }

        .roster-cell {
            padding: 8px 4px;
            text-align: center;
            border-radius: 4px;
            font-weight: 600;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        .toast-success {
            background-color: #dcfce7;
            color: #166534;
            border-left: 4px solid #22c55e;
        }

        .toast-error {
            background-color: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }

        .toast-warning {
            background-color: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }

        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 24px;
        }

        .nav-tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .nav-tab.active {
            border-bottom-color: #2563eb;
            color: #2563eb;
        }

        .nav-tab:hover {
            background-color: #f8fafc;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full">
  <div id="app" class="min-h-full"></div>
  <script>
  // GANTI DENGAN URL WEB APP ANDA
  const GAS_URL = "https://script.google.com/macros/s/AKfycbzzAMcyxm1qjtXdjgKROgS0QqA2S4L7TbZBKabKB8r2fJUIwzLPrU76dcxJH9MHkMoiag/exec";

  const googleSheetSdk = {
    async init(dataHandler) {
      try {
        const response = await fetch(GAS_URL);
        const result = await response.json();

        if (result.isOk) {
          // Panggil data handler asli dari aplikasi Anda
          dataHandler.onDataChanged(result.data);
          return { isOk: true, data: result.data };
        } else {
          console.error("Gagal mengambil data dari Google Sheet:", result.error);
          return { isOk: false, error: result.error };
        }
      } catch (error) {
        console.error("Error saat init:", error);
        return { isOk: false, error: error.message };
      }
    },

    async create(payload) {
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        return await response.json();
      } catch (error) {
        console.error("Error saat create:", error);
        return { isOk: false, error: error.message };
      }
    },

    async update(payload) {
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          // Payload untuk update SUDAH berisi __backendId
          body: JSON.stringify(payload) 
        });
        return await response.json();
      } catch (error) {
        console.error("Error saat update:", error);
        return { isOk: false, error: error.message };
      }
    },

    async delete(payload) {
      try {
        // Tambahkan properti __operation untuk ditangkap oleh doPost
        const deletePayload = { ...payload, __operation: 'delete' };

        const response = await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(deletePayload)
        });
        return await response.json();
      } catch (error) {
        console.error("Error saat delete:", error);
        return { isOk: false, error: error.message };
      }
    }
  };

  // Ganti SDK palsu dengan SDK Google Sheet yang baru
  window.dataSdk = googleSheetSdk;
</script>
  <script>
        const defaultConfig = {
            background_color: "#f0f4f8",
            surface_color: "#ffffff",
            text_color: "#1e293b",
            primary_color: "#2563eb",
            secondary_color: "#64748b",
            font_family: "Inter",
            font_size: 16,
            app_title: "PayBoss",
            company_tagline: "Sistem Absensi & Manajemen Kepegawaian",
            shift1_label: "Shift Pagi",
            shift2_label: "Shift Sore",
            shift3_label: "Shift Malam"
        };

        let currentView = 'login';
        let currentRole = null;
        let currentTab = 'dashboard';
        let stream = null;
        let allRecords = [];
        let employees = [];
        let attendances = [];
        let rosters = [];

        // Reference data untuk 15 karyawan PayBoss dengan posisi sesuai bisnis F&B
        const REFERENCE_EMPLOYEES = [
            { 
                nik: "EMP001", nama: "Ahmad Rizki", posisi: "Koordinator", shift_tetap: "1",
                email: "ahmad.rizki@payboss.com", telepon: "081234567001", 
                alamat: "Jl. Merdeka No. 15, Jakarta Pusat", tanggal_lahir: "1985-03-15",
                tanggal_bergabung: "2020-01-15", pendidikan: "S1 Manajemen Bisnis",
                status_pernikahan: "Menikah", kontak_darurat: "Siti Rizki (Istri) - 081234567002",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiM2MzY2ZjEiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP002", nama: "Siti Nurhaliza", posisi: "Kasir", shift_tetap: "1",
                email: "siti.nurhaliza@payboss.com", telepon: "081234567003",
                alamat: "Jl. Sudirman No. 22, Jakarta Selatan", tanggal_lahir: "1990-07-20",
                tanggal_bergabung: "2021-03-10", pendidikan: "SMK Akuntansi",
                status_pernikahan: "Belum Menikah", kontak_darurat: "Hj. Nurhaliza (Ibu) - 081234567004",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiNlYzQ4OTkiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP003", nama: "Budi Santoso", posisi: "Barista", shift_tetap: "2",
                email: "budi.santoso@payboss.com", telepon: "081234567005",
                alamat: "Jl. Gatot Subroto No. 8, Jakarta Barat", tanggal_lahir: "1988-12-05",
                tanggal_bergabung: "2019-08-20", pendidikan: "SMK Perhotelan",
                status_pernikahan: "Menikah", kontak_darurat: "Ani Santoso (Istri) - 081234567006",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiMxMGI5ODEiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP004", nama: "Dewi Lestari", posisi: "Waitress", shift_tetap: "1",
                email: "dewi.lestari@payboss.com", telepon: "081234567007",
                alamat: "Jl. Thamrin No. 45, Jakarta Pusat", tanggal_lahir: "1992-04-18",
                tanggal_bergabung: "2022-01-05", pendidikan: "SMK Perhotelan",
                status_pernikahan: "Belum Menikah", kontak_darurat: "Pak Lestari (Ayah) - 081234567008",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiNmNTllMGIiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP005", nama: "Eko Prasetyo", posisi: "Koki", shift_tetap: "2",
                email: "eko.prasetyo@payboss.com", telepon: "081234567009",
                alamat: "Jl. Rasuna Said No. 12, Jakarta Selatan", tanggal_lahir: "1987-09-30",
                tanggal_bergabung: "2020-06-15", pendidikan: "SMK Tata Boga",
                status_pernikahan: "Menikah", kontak_darurat: "Rina Prasetyo (Istri) - 081234567010",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiNlZjQ0NDQiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP006", nama: "Fitri Handayani", posisi: "Kasir", shift_tetap: "3",
                email: "fitri.handayani@payboss.com", telepon: "081234567011",
                alamat: "Jl. Kuningan No. 33, Jakarta Selatan", tanggal_lahir: "1991-11-12",
                tanggal_bergabung: "2021-09-01", pendidikan: "SMK Akuntansi",
                status_pernikahan: "Belum Menikah", kontak_darurat: "Ibu Handayani (Ibu) - 081234567012",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiM4YjVjZjYiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP007", nama: "Gunawan Wijaya", posisi: "Supervisor", shift_tetap: "1",
                email: "gunawan.wijaya@payboss.com", telepon: "081234567013",
                alamat: "Jl. Kemang No. 67, Jakarta Selatan", tanggal_lahir: "1984-06-25",
                tanggal_bergabung: "2018-11-10", pendidikan: "S1 Manajemen Restoran",
                status_pernikahan: "Menikah", kontak_darurat: "Maya Wijaya (Istri) - 081234567014",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiMwNjk5NGYiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP008", nama: "Hana Permata", posisi: "Barista", shift_tetap: "3",
                email: "hana.permata@payboss.com", telepon: "081234567015",
                alamat: "Jl. Senayan No. 89, Jakarta Pusat", tanggal_lahir: "1993-02-14",
                tanggal_bergabung: "2022-05-20", pendidikan: "SMK Perhotelan",
                status_pernikahan: "Belum Menikah", kontak_darurat: "Pak Permata (Ayah) - 081234567016",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiNkOTQ2ZWYiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP009", nama: "Indra Kusuma", posisi: "Waitress", shift_tetap: "2",
                email: "indra.kusuma@payboss.com", telepon: "081234567017",
                alamat: "Jl. Menteng No. 54, Jakarta Pusat", tanggal_lahir: "1989-08-08",
                tanggal_bergabung: "2020-12-01", pendidikan: "SMK Perhotelan",
                status_pernikahan: "Menikah", kontak_darurat: "Sari Kusuma (Istri) - 081234567018",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiMzYjgyZjYiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP010", nama: "Joko Widodo", posisi: "Koki", shift_tetap: "1",
                email: "joko.widodo@payboss.com", telepon: "081234567019",
                alamat: "Jl. Cikini No. 76, Jakarta Pusat", tanggal_lahir: "1986-01-21",
                tanggal_bergabung: "2019-04-15", pendidikan: "SMK Tata Boga",
                status_pernikahan: "Menikah", kontak_darurat: "Iriana Widodo (Istri) - 081234567020",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiNmOTczMTYiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP011", nama: "Kartika Sari", posisi: "Waitress", shift_tetap: "3",
                email: "kartika.sari@payboss.com", telepon: "081234567021",
                alamat: "Jl. Blok M No. 91, Jakarta Selatan", tanggal_lahir: "1994-10-03",
                tanggal_bergabung: "2023-02-10", pendidikan: "SMK Perhotelan",
                status_pernikahan: "Belum Menikah", kontak_darurat: "Bu Kartika (Ibu) - 081234567022",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiNmNDY4ZmYiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP012", nama: "Lukman Hakim", posisi: "Supervisor", shift_tetap: "2",
                email: "lukman.hakim@payboss.com", telepon: "081234567023",
                alamat: "Jl. Pancoran No. 38, Jakarta Selatan", tanggal_lahir: "1983-05-17",
                tanggal_bergabung: "2017-07-20", pendidikan: "S1 Manajemen Restoran",
                status_pernikahan: "Menikah", kontak_darurat: "Fatimah Hakim (Istri) - 081234567024",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiMxNGI4YTYiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP013", nama: "Maya Sari", posisi: "Barista", shift_tetap: "1",
                email: "maya.sari@payboss.com", telepon: "081234567025",
                alamat: "Jl. Tebet No. 42, Jakarta Selatan", tanggal_lahir: "1995-06-12",
                tanggal_bergabung: "2023-03-15", pendidikan: "SMK Perhotelan",
                status_pernikahan: "Belum Menikah", kontak_darurat: "Pak Sari (Ayah) - 081234567026",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiNmOTczMTYiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP014", nama: "Rudi Hartono", posisi: "Koki", shift_tetap: "3",
                email: "rudi.hartono@payboss.com", telepon: "081234567027",
                alamat: "Jl. Kalibata No. 28, Jakarta Selatan", tanggal_lahir: "1990-11-08",
                tanggal_bergabung: "2022-08-10", pendidikan: "SMK Tata Boga",
                status_pernikahan: "Menikah", kontak_darurat: "Sari Hartono (Istri) - 081234567028",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiMxNGI4YTYiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            },
            { 
                nik: "EMP015", nama: "Lina Wati", posisi: "Kasir", shift_tetap: "2",
                email: "lina.wati@payboss.com", telepon: "081234567029",
                alamat: "Jl. Pasar Minggu No. 55, Jakarta Selatan", tanggal_lahir: "1993-09-25",
                tanggal_bergabung: "2023-01-20", pendidikan: "SMK Akuntansi",
                status_pernikahan: "Belum Menikah", kontak_darurat: "Bu Wati (Ibu) - 081234567030",
                foto_profil: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGZpbGw9IiNlYzQ4OTkiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIxNSIgZmlsbD0id2hpdGUiLz48cGF0aCBkPSJNMjAgNzVjMC0xNiAxMy40My0zMCAzMC0zMHMzMCAxNCAzMCAzMHYxMEgyMFY3NXoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
            }
        ];

        // Shift configuration
        const SHIFTS = {
            '1': { start: 8, end: 16, name: 'Shift 1', grace: 15 },
            '2': { start: 16, end: 24, name: 'Shift 2', grace: 15 },
            '3': { start: 0, end: 8, name: 'Shift 3', grace: 15 }
        };

        // Work hours tracking
        let workHours = [];
// GANTI FUNGSI LAMA DENGAN FUNGSI BARU INI
function generateWeeklyRoster() {
Â  Â  const today = new Date();
Â  Â  const startOfWeek = new Date(today);
Â  Â  startOfWeek.setDate(today.getDate() - today.getDay()); // Start from Sunday

Â  Â  const rosterData = [];
Â  Â Â 
Â  Â  // *** INI ADALAH PERUBAHAN UTAMA ***
Â  Â  // Kita sekarang menggunakan 'employees' (dari Google Sheet)Â 
Â  Â  // bukan 'REFERENCE_EMPLOYEES' (data hard-coded)
Â  Â  const activeEmployees = employees.filter(emp => emp.status === 'aktif');

Â  Â  if (activeEmployees.length === 0) {
Â  Â  Â  Â  showToast('Tidak ada data karyawan aktif untuk membuat roster.', 'error');
Â  Â  Â  Â  return [];
Â  Â  }

Â  Â  // Generate roster for current week
Â  Â  for (let dayOffset = 0; dayOffset < 7; dayOffset++) {
Â  Â  Â  Â  const currentDate = new Date(startOfWeek);
Â  Â  Â  Â  currentDate.setDate(startOfWeek.getDate() + dayOffset);
Â  Â  Â  Â  const dateStr = currentDate.toISOString().split('T')[0];

Â  Â  Â  Â  // Loop menggunakan karyawan dari Google Sheet
Â  Â  Â  Â  activeEmployees.forEach((emp, index) => {
Â  Â  Â  Â  Â  Â  let shiftRoster;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Logika roster dengan coverage 24/7 untuk bisnis F&B PayBoss
Â  Â  Â  Â  Â  Â  if (emp.posisi === 'Koordinator' || emp.posisi === 'Supervisor') {
Â  Â  Â  Â  Â  Â  Â  Â  // Koordinator & Supervisor: Tetap Senin-Jumat, weekend off
Â  Â  Â  Â  Â  Â  Â  Â  if (dayOffset === 0 || dayOffset === 6) { // Sunday & Saturday
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shiftRoster = 'OFF';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shiftRoster = emp.shift_tetap;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Kasir, Barista, Waitress, Koki: Rotasi untuk coverage 24/7 termasuk weekend
Â  Â  Â  Â  Â  Â  Â  Â  const weekNumber = Math.floor(today.getTime() / (7 * 24 * 60 * 60 * 1000));
Â  Â  Â  Â  Â  Â  Â  Â  const employeeRotation = (weekNumber + index) % 4; // 4 pola rotasi
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const rotationPatterns = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [0, 1, 1, 1, 1, 1, 0], // OFF, Senin-Jumat, OFF
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [0, 0, 1, 1, 1, 1, 1], // OFF, OFF, Selasa-Sabtu
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [1, 0, 0, 1, 1, 1, 1], // Minggu, OFF, OFF, Rabu-Sabtu
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [1, 1, 1, 1, 1, 0, 0]Â  // Minggu-Kamis, OFF, OFF
Â  Â  Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const pattern = rotationPatterns[employeeRotation];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (pattern[dayOffset] === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shiftRoster = 'OFF';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Rotasi shift untuk hari kerja dengan prioritas weekend coverage
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (dayOffset === 0 || dayOffset === 6) { // Weekend
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (emp.posisi === 'Kasir') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cashierShifts = ['1', '2', '1'];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const shiftIndex = (weekNumber + index) % 3;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shiftRoster = cashierShifts[shiftIndex];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (emp.posisi === 'Koki') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cookShifts = ['1', '2', '3'];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const shiftIndex = (weekNumber + index) % 3;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shiftRoster = cookShifts[shiftIndex];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (emp.posisi === 'Barista') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const baristaShifts = ['1', '2', '1'];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const shiftIndex = (weekNumber + index) % 3;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shiftRoster = baristaShifts[shiftIndex];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { // Waitress
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const waitressShifts = ['1', '2', '3'];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const shiftIndex = (weekNumber + index) % 3;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shiftRoster = waitressShifts[shiftIndex];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Untuk weekday
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (emp.posisi === 'Kasir') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cashierWeekdayShifts = ['1', '2'];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const shiftIndex = (weekNumber + index + dayOffset) % 2;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shiftRoster = cashierWeekdayShifts[shiftIndex];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const weekdayShiftRotation = (weekNumber + index + dayOffset) % 3;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const shifts = ['1', '2', '3'];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shiftRoster = shifts[weekdayShiftRotation];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  mÂ  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Check for existing leave requests
Â  Â  Â  Â  Â  Â  const existingLeave = allRecords.find(r =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  r.type === 'leave_request' &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  r.nik === emp.nik &&Â 
Â  mÂ  Â  Â  Â  Â  Â  r.tanggal === dateStr &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  r.status === 'approved'
Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  if (existingLeave) {
Â  Â  Â  Â  Â  Â  Â  Â  shiftRoster = existingLeave.leave_type === 'cuti' ? 'CUTI' : 'IJIN';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const rosterEntry = {
Â  Â  Â  Â  Â  Â  Â  Â  nik: emp.nik,
Â  Â  Â  Â  Â  Â  Â  Â  nama: emp.nama,
Â  Â  Â  Â  Â  Â  Â  Â  posisi: emp.posisi,
Â  Â  Â  Â  Â  Â  Â  Â  tanggal: dateStr,
Â  Â  Â  Â  Â  Â  Â  Â  shift_roster: shiftRoster,
Â  Â  Â  Â  Â  Â  Â  Â  jam_kerja_normal: 8, // Ini akan cocok dengan header 'jam_kerja_normal'
Â  Â  Â  Â  Â  Â  Â  Â  keterangan: shiftRoster === 'OFF' ? 'Libur (2 dari 7 hari)' :Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shiftRoster === 'CUTI' ? 'Cuti Tahunan' :Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shiftRoster === 'IJIN' ? 'Ijin Khusus' :
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `${emp.posisi} ${getShiftLabel(shiftRoster)} - 8 jam kerja${(dayOffset === 0 || dayOffset === 6) ? ' (Weekend F&B)' : ''}`,
Â  Â  Â  Â  Â  Â  Â  Â  type: 'roster'
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  rosterData.push(rosterEntry);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  return rosterData;
 
Â  Â  Â  Â  async function generateAndSaveRoster() {
            const btn = document.getElementById('generateRosterBtn');
            if (!btn) return;

            btn.disabled = true;
            btn.innerHTML = '<div class="loading-spinner"></div><span>Membuat Roster...</span>';

            // Check if roster already exists for this week
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            const weekStart = startOfWeek.toISOString().split('T')[0];

            const existingRoster = rosters.filter(r => r.tanggal >= weekStart);
            
            if (existingRoster.length > 0) {
                showToast('Roster minggu ini sudah ada. Hapus roster lama terlebih dahulu.', 'warning');
                btn.disabled = false;
                btn.innerHTML = 'ðŸ“… Generate Roster Mingguan';
                return;
            }

            const rosterData = generateWeeklyRoster();
            
            // Save all roster entries
            let successCount = 0;
            for (const entry of rosterData) {
                const result = await window.dataSdk.create(entry);
                if (result.isOk) {
                    successCount++;
                }
            }

            if (successCount === rosterData.length) {
                showToast(`Roster berhasil dibuat untuk ${successCount} jadwal kerja!`, 'success');
            } else {
                showToast(`Roster sebagian berhasil dibuat (${successCount}/${rosterData.length})`, 'warning');
            }

            btn.disabled = false;
            btn.innerHTML = 'ðŸ“… Generate Roster Mingguan';
        }

        async function clearRoster() {
            const confirmBtn = document.getElementById('clearRosterConfirm');
            if (!confirmBtn) return;

            confirmBtn.disabled = true;
            confirmBtn.innerHTML = '<div class="loading-spinner"></div>';

            let deletedCount = 0;
            for (const roster of rosters) {
                const result = await window.dataSdk.delete(roster);
                if (result.isOk) {
                    deletedCount++;
                }
            }

            if (deletedCount > 0) {
                showToast(`${deletedCount} jadwal roster berhasil dihapus`, 'success');
            }

            hideDeleteConfirm('clearRoster');
        }

        function detectShift(date) {
            const hour = date.getHours();
            const minute = date.getMinutes();
            const totalMinutes = hour * 60 + minute;

            // Shift 1: 07:45 - 16:15 (08:00 - 16:00 Â±15 min)
            if (totalMinutes >= 465 && totalMinutes <= 975) return '1';
            // Shift 2: 15:45 - 00:15 (16:00 - 24:00 Â±15 min)
            if (totalMinutes >= 945 || totalMinutes <= 15) return '2';
            // Shift 3: 23:45 - 08:15 (00:00 - 08:00 Â±15 min)
            if (totalMinutes >= 1425 || totalMinutes <= 495) return '3';
            
            return '1'; // Default
        }

        function getAttendanceStatus(detectedShift, scheduledShift, time) {
            if (detectedShift !== scheduledShift) {
                return 'tidak-sesuai';
            }

            const hour = time.getHours();
            const minute = time.getMinutes();
            const shift = SHIFTS[detectedShift];
            
            // Check if late (more than grace period after shift start)
            const shiftStartMinutes = shift.start * 60;
            const currentMinutes = hour * 60 + minute;
            
            if (currentMinutes > shiftStartMinutes + shift.grace) {
                return 'terlambat';
            }

            return 'hadir';
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                const video = document.getElementById('video');
                if (video) {
                    video.srcObject = stream;
                }
            } catch (error) {
                showToast('Gagal mengakses kamera. Pastikan izin kamera diberikan.', 'error');
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
        }

        async function capturePhoto() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            
            if (!video || !canvas) return null;

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);

            return canvas.toDataURL('image/jpeg', 0.8);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', { 
                day: '2-digit', 
                month: 'short', 
                year: 'numeric' 
            });
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString('id-ID', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function getShiftLabel(shiftNum) {
            const config = window.elementSdk?.config || defaultConfig;
            const labels = {
                '1': config.shift1_label || defaultConfig.shift1_label,
                '2': config.shift2_label || defaultConfig.shift2_label,
                '3': config.shift3_label || defaultConfig.shift3_label
            };
            return labels[shiftNum] || `Shift ${shiftNum}`;
        }

        function switchTab(tabName) {
            currentTab = tabName;
            render();
        }

        async function handleLogin(role) {
            currentRole = role;
            currentView = role === 'admin' ? 'dashboard' : 'attendance';
            currentTab = 'dashboard';
            await render();
        }

        async function handleLogout() {
            stopCamera();
            currentRole = null;
            currentView = 'login';
            await render();
        }

        async function handleNIKSubmit() {
            const nikInput = document.getElementById('nikInput');
            const nik = nikInput?.value?.trim();

            if (!nik) {
                showToast('Masukkan NIK terlebih dahulu', 'warning');
                return;
            }

            // Check in stored employees first
            let employee = employees.find(emp => emp.nik === nik && emp.status === 'aktif');
            
            // If not found in stored data, check reference data
            if (!employee) {
                const refEmployee = REFERENCE_EMPLOYEES.find(emp => emp.nik === nik);
                if (refEmployee) {
                    employee = refEmployee;
                    employee.status = 'aktif'; // Set as active for reference employees
                } else {
                    showToast('NIK tidak ditemukan. Gunakan NIK: EMP001 - EMP012', 'error');
                    return;
                }
            }

            // Store employee data and go to employee dashboard
            window.currentEmployee = employee;
            currentView = 'employee_dashboard';
            await render();
        }

        function getShiftTime(shiftNum) {
            const times = {
                '1': '08:00 - 16:00',
                '2': '16:00 - 24:00', 
                '3': '00:00 - 08:00'
            };
            return times[shiftNum] || '-';
        }

        function startAttendanceProcess(type) {
            window.attendanceType = type;
            currentView = 'camera';
            render().then(() => startCamera());
        }

        function openEmployeeLeaveModal(nik) {
            const modal = document.getElementById('leaveRequestModal');
            if (modal) {
                // Pre-fill NIK
                const nikField = modal.querySelector('[name="nik"]');
                if (nikField) nikField.value = nik;
                modal.classList.remove('hidden');
            }
        }

        function openEmployeeOvertimeModal(nik) {
            const modal = document.getElementById('overtimeModal');
            if (modal) {
                // Pre-fill NIK
                const nikField = modal.querySelector('[name="nik"]');
                if (nikField) nikField.value = nik;
                modal.classList.remove('hidden');
            }
        }

        function openLeaveModalWithNIK() {
            const nikInput = document.getElementById('nikInput');
            const nik = nikInput?.value?.trim();
            
            if (!nik) {
                showToast('Masukkan NIK terlebih dahulu untuk mengajukan cuti/ijin', 'warning');
                return;
            }

            // Validate employee exists
            const employee = REFERENCE_EMPLOYEES.find(emp => emp.nik === nik) || 
                           employees.find(emp => emp.nik === nik && emp.status === 'aktif');
            
            if (!employee) {
                showToast('NIK tidak ditemukan. Gunakan NIK: EMP001 - EMP012', 'error');
                return;
            }

            const modal = document.getElementById('leaveRequestModal');
            if (modal) {
                // Pre-fill NIK and employee name
                const nikField = modal.querySelector('[name="nik"]');
                if (nikField) {
                    nikField.value = nik;
                    nikField.readOnly = true;
                }
                
                // Update modal title to show employee name
                const modalTitle = modal.querySelector('h2');
                if (modalTitle) {
                    modalTitle.innerHTML = `Pengajuan Cuti/Ijin - ${employee.nama}`;
                }
                
                // Reset calendar date and selected date
                leaveCalendarDate = new Date();
                const selectedDateInput = document.getElementById('selectedLeaveDate');
                const selectedDateDisplay = document.getElementById('selectedLeaveDateDisplay');
                if (selectedDateInput) selectedDateInput.value = '';
                if (selectedDateDisplay) selectedDateDisplay.textContent = '';
                
                modal.classList.remove('hidden');
                
                // Initialize calendar
                setTimeout(() => {
                    generateCalendar(leaveCalendarDate, 'leaveCalendarGrid', 'leave');
                    updateCalendarHeader(leaveCalendarDate, 'currentMonthLeave');
                    setupCalendarNavigation('leave');
                }, 100);
            }
        }

        function openOvertimeModalWithNIK() {
            const nikInput = document.getElementById('nikInput');
            const nik = nikInput?.value?.trim();
            
            if (!nik) {
                showToast('Masukkan NIK terlebih dahulu untuk melaporkan lembur', 'warning');
                return;
            }

            // Validate employee exists
            const employee = REFERENCE_EMPLOYEES.find(emp => emp.nik === nik) || 
                           employees.find(emp => emp.nik === nik && emp.status === 'aktif');
            
            if (!employee) {
                showToast('NIK tidak ditemukan. Gunakan NIK: EMP001 - EMP012', 'error');
                return;
            }

            const modal = document.getElementById('overtimeModal');
            if (modal) {
                // Pre-fill NIK and employee name
                const nikField = modal.querySelector('[name="nik"]');
                if (nikField) {
                    nikField.value = nik;
                    nikField.readOnly = true;
                }
                
                // Update modal title to show employee name
                const modalTitle = modal.querySelector('h2');
                if (modalTitle) {
                    modalTitle.innerHTML = `Laporan Lembur - ${employee.nama}`;
                }
                
                // Reset calendar date and selected date
                overtimeCalendarDate = new Date();
                const selectedDateInput = document.getElementById('selectedOvertimeDate');
                const selectedDateDisplay = document.getElementById('selectedOvertimeDateDisplay');
                const calculationDiv = document.getElementById('overtimeHoursCalculation');
                if (selectedDateInput) selectedDateInput.value = '';
                if (selectedDateDisplay) selectedDateDisplay.textContent = '';
                if (calculationDiv) calculationDiv.style.display = 'none';
                
                modal.classList.remove('hidden');
                
                // Initialize calendar and overtime calculation
                setTimeout(() => {
                    generateCalendar(overtimeCalendarDate, 'overtimeCalendarGrid', 'overtime');
                    updateCalendarHeader(overtimeCalendarDate, 'currentMonthOvertime');
                    setupCalendarNavigation('overtime');
                    setupOvertimeCalculation();
                }, 100);
            }
        }

        async function handleTakePhoto() {
            const btn = document.getElementById('captureBtn');
            if (!btn) return;

            btn.disabled = true;
            btn.innerHTML = '<div class="loading-spinner"></div><span>Memproses...</span>';

            const photoData = await capturePhoto();
            
            if (!photoData) {
                showToast('Gagal mengambil foto', 'error');
                btn.disabled = false;
                btn.innerHTML = 'ðŸ“¸ Ambil Foto';
                return;
            }

            // Use stored employee data
            const employee = window.currentEmployee;
            const attendanceType = window.attendanceType || 'checkin';
            
            if (!employee) {
                showToast('Data karyawan tidak ditemukan', 'error');
                btn.disabled = false;
                btn.innerHTML = 'ðŸ“¸ Ambil Foto';
                return;
            }

            const now = new Date();
            const today = new Date().toISOString().split('T')[0];
            
            // Get today's roster
            const todayRoster = rosters.find(r => r.nik === employee.nik && r.tanggal === today);
            const scheduledShift = todayRoster ? todayRoster.shift_roster : employee.shift_tetap;
            
            // Check if employee is supposed to work today
            if (todayRoster && (todayRoster.shift_roster === 'OFF' || todayRoster.shift_roster === 'CUTI' || todayRoster.shift_roster === 'IJIN')) {
                showToast(`Anda sedang ${todayRoster.shift_roster === 'OFF' ? 'libur' : todayRoster.shift_roster.toLowerCase()} hari ini`, 'warning');
                btn.disabled = false;
                btn.innerHTML = 'ðŸ“¸ Ambil Foto';
                return;
            }

            const detectedShift = detectShift(now);
            const status = getAttendanceStatus(detectedShift, scheduledShift, now);

            const attendanceData = {
                nik: employee.nik,
                nama: employee.nama,
                posisi: employee.posisi,
                shift_tetap: employee.shift_tetap,
                status: 'aktif',
                waktu_absen: now.toISOString(),
                shift_terdeteksi: detectedShift,
                shift_jadwal: scheduledShift,
                foto_data: photoData,
                lokasi: 'Lokasi Kerja',
                status_absen: status,
                attendance_type: attendanceType,
                type: 'attendance'
            };

            // If this is checkout, calculate work hours
            if (attendanceType === 'checkout') {
                const todayAttendances = attendances.filter(att => {
                    const attDate = new Date(att.waktu_absen).toISOString().split('T')[0];
                    return attDate === today && att.nik === employee.nik && att.attendance_type === 'checkin';
                });

                if (todayAttendances.length > 0) {
                    const checkinRecord = todayAttendances[0];
                    const checkinTime = new Date(checkinRecord.waktu_absen);
                    const checkoutTime = now;
                    const workMinutes = Math.round((checkoutTime - checkinTime) / (1000 * 60));
                    const workHoursDecimal = workMinutes / 60;

                    // Save work hours record
                    const workHoursData = {
                        nik: employee.nik,
                        nama: employee.nama,
                        tanggal: today,
                        jam_masuk: checkinRecord.waktu_absen,
                        jam_keluar: now.toISOString(),
                        total_menit: workMinutes,
                        total_jam: workHoursDecimal,
                        shift: detectedShift,
                        type: 'work_hours'
                    };

                    await window.dataSdk.create(workHoursData);
                }
            }

            const result = await window.dataSdk.create(attendanceData);

            if (result.isOk) {
                stopCamera();
                showToast(`${attendanceType === 'checkout' ? 'Absen pulang' : 'Absen masuk'} berhasil dicatat!`, 'success');
                currentView = 'success';
                window.lastAttendanceType = attendanceType;
                await render();
            } else {
                showToast('Gagal menyimpan absensi', 'error');
                btn.disabled = false;
                btn.innerHTML = 'ðŸ“¸ Ambil Foto';
            }
        }

        function handleBackToAttendance() {
            stopCamera();
            currentView = 'attendance';
            render();
        }

        function handleBackToEmployeeDashboard() {
            currentView = 'employee_dashboard';
            render();
        }

        function handleBackToLogin() {
            currentView = 'login';
            render();
        }

        async function handleAddEmployee() {
            const form = document.getElementById('employeeForm');
            if (!form) return;

            const formData = new FormData(form);
            const employeeData = {
                nik: formData.get('nik'),
                nama: formData.get('nama'),
                posisi: formData.get('posisi'),
                shift_tetap: formData.get('shift_tetap'),
                email: formData.get('email'),
                telepon: formData.get('telepon'),
                alamat: formData.get('alamat'),
                tanggal_lahir: formData.get('tanggal_lahir'),
                tanggal_bergabung: formData.get('tanggal_bergabung'),
                pendidikan: formData.get('pendidikan'),
                status_pernikahan: formData.get('status_pernikahan'),
                kontak_darurat: formData.get('kontak_darurat'),
                foto_profil: formData.get('foto_profil') || generateDefaultAvatar(formData.get('nama')),
                status: 'aktif',
                type: 'employee'
            };

            // Check if NIK already exists
            const exists = employees.some(emp => emp.nik === employeeData.nik);
            if (exists) {
                showToast('NIK sudah terdaftar', 'error');
                return;
            }

            const result = await window.dataSdk.create(employeeData);

            if (result.isOk) {
                showToast('Profil karyawan berhasil ditambahkan', 'success');
                form.reset();
                closeModal('addEmployeeModal');
            } else {
                showToast('Gagal menambahkan profil karyawan', 'error');
            }
        }

        async function handleEditEmployee() {
            const form = document.getElementById('editEmployeeForm');
            if (!form) return;

            const btn = form.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.innerHTML = '<div class="loading-spinner"></div><span>Menyimpan...</span>';

            const formData = new FormData(form);
            const employeeId = formData.get('employee_id');
            
            // Find the employee record
            const employee = allRecords.find(r => r.__backendId === employeeId);
            if (!employee) {
                showToast('Data karyawan tidak ditemukan', 'error');
                btn.disabled = false;
                btn.innerHTML = 'Simpan Perubahan';
                return;
            }

            // Update employee data
            const updatedEmployee = {
                ...employee,
                nama: formData.get('nama'),
                posisi: formData.get('posisi'),
                shift_tetap: formData.get('shift_tetap'),
                email: formData.get('email'),
                telepon: formData.get('telepon'),
                alamat: formData.get('alamat'),
                tanggal_lahir: formData.get('tanggal_lahir'),
                tanggal_bergabung: formData.get('tanggal_bergabung'),
                pendidikan: formData.get('pendidikan'),
                status_pernikahan: formData.get('status_pernikahan'),
                kontak_darurat: formData.get('kontak_darurat'),
                foto_profil: formData.get('foto_profil') || employee.foto_profil || generateDefaultAvatar(formData.get('nama'))
            };

            const result = await window.dataSdk.update(updatedEmployee);

            if (result.isOk) {
                showToast('Profil karyawan berhasil diperbarui', 'success');
                closeModal('editEmployeeModal');
            } else {
                showToast('Gagal memperbarui profil karyawan', 'error');
            }

            btn.disabled = false;
            btn.innerHTML = 'Simpan Perubahan';
        }

        function generateDefaultAvatar(nama) {
            const colors = ['#6366f1', '#ec4899', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06994f', '#d946ef', '#3b82f6', '#f97316', '#14b8a6'];
            const colorIndex = (nama?.length || 0) % colors.length;
            const color = colors[colorIndex];
            
            return `data:image/svg+xml;base64,${btoa(`<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50" fill="${color}"/><circle cx="50" cy="35" r="15" fill="white"/><path d="M20 75c0-16 13.43-30 30-30s30 14 30 30v10H20V75z" fill="white"/></svg>`)}`;
        }

        function openEditEmployeeModal(employee) {
            const modal = document.getElementById('editEmployeeModal');
            if (!modal) return;

            // Populate form with employee data
            const form = document.getElementById('editEmployeeForm');
            if (form) {
                form.querySelector('[name="employee_id"]').value = employee.__backendId || '';
                form.querySelector('[name="nik"]').value = employee.nik || '';
                form.querySelector('[name="nama"]').value = employee.nama || '';
                form.querySelector('[name="posisi"]').value = employee.posisi || '';
                form.querySelector('[name="shift_tetap"]').value = employee.shift_tetap || '1';
                form.querySelector('[name="email"]').value = employee.email || '';
                form.querySelector('[name="telepon"]').value = employee.telepon || '';
                form.querySelector('[name="alamat"]').value = employee.alamat || '';
                form.querySelector('[name="tanggal_lahir"]').value = employee.tanggal_lahir || '';
                form.querySelector('[name="tanggal_bergabung"]').value = employee.tanggal_bergabung || '';
                form.querySelector('[name="pendidikan"]').value = employee.pendidikan || '';
                form.querySelector('[name="status_pernikahan"]').value = employee.status_pernikahan || 'Belum Menikah';
                form.querySelector('[name="kontak_darurat"]').value = employee.kontak_darurat || '';
                form.querySelector('[name="foto_profil"]').value = employee.foto_profil || '';
            }

            modal.classList.remove('hidden');
        }

        async function handleDeleteEmployee(record) {
            const confirmBtn = document.getElementById(`confirm-delete-${record.__backendId}`);
            if (!confirmBtn) return;

            confirmBtn.disabled = true;
            confirmBtn.innerHTML = '<div class="loading-spinner"></div>';

            const result = await window.dataSdk.delete(record);

            if (result.isOk) {
                showToast('Karyawan berhasil dihapus', 'success');
            } else {
                showToast('Gagal menghapus karyawan', 'error');
                confirmBtn.disabled = false;
                confirmBtn.innerHTML = 'Ya, Hapus';
            }
        }

        function showDeleteConfirm(recordId) {
            const btn = document.getElementById(`delete-btn-${recordId}`);
            const confirmDiv = document.getElementById(`confirm-delete-div-${recordId}`);
            if (btn && confirmDiv) {
                btn.style.display = 'none';
                confirmDiv.style.display = 'flex';
            }
        }

        function hideDeleteConfirm(recordId) {
            const btn = document.getElementById(`delete-btn-${recordId}`);
            const confirmDiv = document.getElementById(`confirm-delete-div-${recordId}`);
            if (btn && confirmDiv) {
                btn.style.display = 'block';
                confirmDiv.style.display = 'none';
            }
        }

        function openEditRosterModal(recordId, nik, nama, tanggal, currentShift) {
            const modal = document.getElementById('editRosterModal');
            if (!modal) return;

            const config = window.elementSdk?.config || defaultConfig;
            const baseSize = config.font_size || defaultConfig.font_size;

            // Format tanggal untuk display
            const date = new Date(tanggal);
            const dayNames = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            const formattedDate = `${dayNames[date.getDay()]}, ${date.getDate()} ${monthNames[date.getMonth()]} ${date.getFullYear()}`;

            modal.innerHTML = `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-6 modal-backdrop">
                    <div class="rounded-2xl p-8 max-w-md w-full shadow-2xl fade-in" style="background-color: ${config.surface_color}">
                        <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Edit Roster Karyawan</h2>
                        
                        <div class="mb-6 p-4 rounded-lg" style="background-color: ${config.background_color}">
                            <div class="text-center">
                                <h3 class="font-semibold mb-1" style="font-size: ${baseSize * 1.1}px; color: ${config.text_color}">${nama}</h3>
                                <p style="font-size: ${baseSize * 0.9}px; color: ${config.secondary_color}">${nik}</p>
                                <p class="font-medium mt-2" style="font-size: ${baseSize}px; color: ${config.primary_color}">${formattedDate}</p>
                            </div>
                        </div>

                        <form id="editRosterForm" onsubmit="event.preventDefault(); handleEditRoster('${recordId}');">
                            <div class="mb-6">
                                <label class="block font-semibold mb-3" style="font-size: ${baseSize}px; color: ${config.text_color}">Pilih Shift/Status:</label>
                                <div class="space-y-2">
                                    <label class="flex items-center p-3 rounded-lg border-2 cursor-pointer hover:bg-gray-50" style="border-color: ${currentShift === '1' ? config.primary_color : '#e2e8f0'}">
                                        <input type="radio" name="shift_roster" value="1" ${currentShift === '1' ? 'checked' : ''} class="mr-3">
                                        <div class="flex items-center gap-2">
                                            <span class="shift-badge shift-1" style="font-size: ${baseSize * 0.8}px">${config.shift1_label || 'Shift Pagi'}</span>
                                            <span style="font-size: ${baseSize * 0.85}px; color: ${config.secondary_color}">08:00 - 16:00</span>
                                        </div>
                                    </label>
                                    <label class="flex items-center p-3 rounded-lg border-2 cursor-pointer hover:bg-gray-50" style="border-color: ${currentShift === '2' ? config.primary_color : '#e2e8f0'}">
                                        <input type="radio" name="shift_roster" value="2" ${currentShift === '2' ? 'checked' : ''} class="mr-3">
                                        <div class="flex items-center gap-2">
                                            <span class="shift-badge shift-2" style="font-size: ${baseSize * 0.8}px">${config.shift2_label || 'Shift Sore'}</span>
                                            <span style="font-size: ${baseSize * 0.85}px; color: ${config.secondary_color}">16:00 - 24:00</span>
                                        </div>
                                    </label>
                                    <label class="flex items-center p-3 rounded-lg border-2 cursor-pointer hover:bg-gray-50" style="border-color: ${currentShift === '3' ? config.primary_color : '#e2e8f0'}">
                                        <input type="radio" name="shift_roster" value="3" ${currentShift === '3' ? 'checked' : ''} class="mr-3">
                                        <div class="flex items-center gap-2">
                                            <span class="shift-badge shift-3" style="font-size: ${baseSize * 0.8}px">${config.shift3_label || 'Shift Malam'}</span>
                                            <span style="font-size: ${baseSize * 0.85}px; color: ${config.secondary_color}">00:00 - 08:00</span>
                                        </div>
                                    </label>
                                    <label class="flex items-center p-3 rounded-lg border-2 cursor-pointer hover:bg-gray-50" style="border-color: ${currentShift === 'OFF' ? config.primary_color : '#e2e8f0'}">
                                        <input type="radio" name="shift_roster" value="OFF" ${currentShift === 'OFF' ? 'checked' : ''} class="mr-3">
                                        <div class="flex items-center gap-2">
                                            <span class="shift-badge shift-off" style="font-size: ${baseSize * 0.8}px">LIBUR</span>
                                            <span style="font-size: ${baseSize * 0.85}px; color: ${config.secondary_color}">Hari libur</span>
                                        </div>
                                    </label>
                                    <label class="flex items-center p-3 rounded-lg border-2 cursor-pointer hover:bg-gray-50" style="border-color: ${currentShift === 'CUTI' ? config.primary_color : '#e2e8f0'}">
                                        <input type="radio" name="shift_roster" value="CUTI" ${currentShift === 'CUTI' ? 'checked' : ''} class="mr-3">
                                        <div class="flex items-center gap-2">
                                            <span style="background-color: #fef3c7; color: #92400e; padding: 4px 10px; border-radius: 12px; font-size: ${baseSize * 0.8}px; font-weight: 600;">CUTI</span>
                                            <span style="font-size: ${baseSize * 0.85}px; color: ${config.secondary_color}">Cuti/Izin</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="flex gap-3">
                                <button type="button" onclick="closeModal('editRosterModal')" class="flex-1 px-4 py-3 rounded-lg font-semibold" style="background-color: #e2e8f0; color: ${config.secondary_color}; font-size: ${baseSize}px">
                                    Batal
                                </button>
                                <button type="submit" class="flex-1 px-4 py-3 rounded-lg font-semibold text-white" style="background-color: ${config.primary_color}; font-size: ${baseSize}px">
                                    Simpan Perubahan
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
        }

        async function handleEditRoster(recordId) {
            const form = document.getElementById('editRosterForm');
            if (!form) return;

            const btn = form.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.innerHTML = '<div class="loading-spinner"></div><span>Menyimpan...</span>';

            const formData = new FormData(form);
            const newShift = formData.get('shift_roster');

            // Find the roster record
            const rosterRecord = allRecords.find(r => r.__backendId === recordId);
            if (!rosterRecord) {
                showToast('Data roster tidak ditemukan', 'error');
                btn.disabled = false;
                btn.innerHTML = 'Simpan Perubahan';
                return;
            }

            // Update roster data
            const updatedRoster = {
                ...rosterRecord,
                shift_roster: newShift,
                keterangan: newShift === 'OFF' ? 'Libur (2 dari 7 hari)' : 
                           newShift === 'CUTI' ? 'Cuti Tahunan' : 
                           newShift === 'IJIN' ? 'Ijin Khusus' :
                           `Jadwal ${getShiftLabel(newShift)} - 8 jam kerja`
            };

            const result = await window.dataSdk.update(updatedRoster);

            if (result.isOk) {
                showToast('Roster berhasil diperbarui', 'success');
                closeModal('editRosterModal');
            } else {
                showToast('Gagal memperbarui roster', 'error');
            }

            btn.disabled = false;
            btn.innerHTML = 'Simpan Perubahan';
        }

        async function handleLeaveRequest() {
            const form = document.getElementById('leaveRequestForm');
            if (!form) return;

            const btn = form.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.innerHTML = '<div class="loading-spinner"></div><span>Mengajukan...</span>';

            const formData = new FormData(form);
            const nik = formData.get('nik');

            // Validate employee exists
            const employee = REFERENCE_EMPLOYEES.find(emp => emp.nik === nik) || 
                           employees.find(emp => emp.nik === nik && emp.status === 'aktif');
            
            if (!employee) {
                showToast('NIK tidak ditemukan', 'error');
                btn.disabled = false;
                btn.innerHTML = 'Ajukan';
                return;
            }

            const leaveData = {
                nik: nik,
                nama: employee.nama,
                posisi: employee.posisi,
                leave_type: formData.get('leave_type'),
                tanggal: formData.get('tanggal'),
                alasan: formData.get('alasan'),
                status: 'pending', // pending, approved, rejected
                tanggal_pengajuan: new Date().toISOString(),
                type: 'leave_request'
            };

            const result = await window.dataSdk.create(leaveData);

            if (result.isOk) {
                showToast('Pengajuan cuti/ijin berhasil dikirim', 'success');
                form.reset();
                closeModal('leaveRequestModal');
            } else {
                showToast('Gagal mengirim pengajuan', 'error');
            }

            btn.disabled = false;
            btn.innerHTML = 'Ajukan';
        }

        // Calendar state variables
        let leaveCalendarDate = new Date();
        let overtimeCalendarDate = new Date();

        function initializeCalendars() {
            // Initialize leave calendar
            const leaveModal = document.getElementById('leaveRequestModal');
            if (leaveModal && !leaveModal.classList.contains('hidden')) {
                generateCalendar(leaveCalendarDate, 'leaveCalendarGrid', 'leave');
                updateCalendarHeader(leaveCalendarDate, 'currentMonthLeave');
                setupCalendarNavigation('leave');
            }

            // Initialize overtime calendar
            const overtimeModal = document.getElementById('overtimeModal');
            if (overtimeModal && !overtimeModal.classList.contains('hidden')) {
                generateCalendar(overtimeCalendarDate, 'overtimeCalendarGrid', 'overtime');
                updateCalendarHeader(overtimeCalendarDate, 'currentMonthOvertime');
                setupCalendarNavigation('overtime');
                setupOvertimeCalculation();
            }
        }

        function setupCalendarNavigation(type) {
            const prevBtn = document.getElementById(`prevMonth${type === 'leave' ? 'Leave' : 'Overtime'}`);
            const nextBtn = document.getElementById(`nextMonth${type === 'leave' ? 'Leave' : 'Overtime'}`);
            
            if (prevBtn) {
                prevBtn.onclick = () => navigateCalendar(type, -1);
            }
            if (nextBtn) {
                nextBtn.onclick = () => navigateCalendar(type, 1);
            }
        }

        function setupOvertimeCalculation() {
            const jamMulai = document.querySelector('#overtimeForm [name="jam_mulai"]');
            const jamSelesai = document.querySelector('#overtimeForm [name="jam_selesai"]');
            const shiftSelect = document.querySelector('#overtimeForm [name="shift_lembur"]');

            if (jamMulai && jamSelesai && shiftSelect) {
                const calculateHours = () => {
                    if (jamMulai.value && jamSelesai.value) {
                        const startTime = new Date(`2000-01-01T${jamMulai.value}:00`);
                        const endTime = new Date(`2000-01-01T${jamSelesai.value}:00`);
                        
                        // Handle overnight overtime
                        if (endTime < startTime) {
                            endTime.setDate(endTime.getDate() + 1);
                        }
                        
                        const overtimeMinutes = (endTime - startTime) / (1000 * 60);
                        const overtimeHours = overtimeMinutes / 60;

                        // Calculate rate based on shift type
                        let rate = 1.5; // Default rate
                        const shiftType = shiftSelect.value;
                        if (shiftType === 'weekend') rate = 2.0;
                        if (shiftType === 'holiday') rate = 2.5;

                        const points = Math.round(overtimeHours * rate * 10);

                        // Update display
                        const calculationDiv = document.getElementById('overtimeHoursCalculation');
                        const totalHoursEl = document.getElementById('totalOvertimeHours');
                        const rateEl = document.getElementById('overtimeRate');
                        const pointsEl = document.getElementById('overtimePoints');

                        if (calculationDiv && totalHoursEl && rateEl && pointsEl) {
                            calculationDiv.style.display = 'block';
                            totalHoursEl.textContent = overtimeHours.toFixed(1);
                            rateEl.textContent = `${rate}x`;
                            pointsEl.textContent = points;
                        }
                    }
                };

                jamMulai.addEventListener('change', calculateHours);
                jamSelesai.addEventListener('change', calculateHours);
                shiftSelect.addEventListener('change', calculateHours);
            }
        }

        function navigateCalendar(type, direction) {
            if (type === 'leave') {
                leaveCalendarDate.setMonth(leaveCalendarDate.getMonth() + direction);
                generateCalendar(leaveCalendarDate, 'leaveCalendarGrid', 'leave');
                updateCalendarHeader(leaveCalendarDate, 'currentMonthLeave');
            } else {
                overtimeCalendarDate.setMonth(overtimeCalendarDate.getMonth() + direction);
                generateCalendar(overtimeCalendarDate, 'overtimeCalendarGrid', 'overtime');
                updateCalendarHeader(overtimeCalendarDate, 'currentMonthOvertime');
            }
        }

        function updateCalendarHeader(date, headerId) {
            const header = document.getElementById(headerId);
            if (header) {
                const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
                header.textContent = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
            }
        }

        function selectCalendarDate(dateStr, type) {
            const selectedDate = new Date(dateStr);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            selectedDate.setHours(0, 0, 0, 0);

            // Prevent selecting past dates
            if (selectedDate < today) {
                showToast('Tidak dapat memilih tanggal yang sudah lewat', 'warning');
                return;
            }

            if (type === 'leave') {
                const dateInput = document.getElementById('selectedLeaveDate');
                const display = document.getElementById('selectedLeaveDateDisplay');
                
                if (dateInput) dateInput.value = dateStr;
                if (display) {
                    const dayNames = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
                    const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
                    display.textContent = `ðŸ“… ${dayNames[selectedDate.getDay()]}, ${selectedDate.getDate()} ${monthNames[selectedDate.getMonth()]} ${selectedDate.getFullYear()}`;
                    display.style.display = 'block';
                }
            } else if (type === 'overtime') {
                const dateInput = document.getElementById('selectedOvertimeDate');
                const display = document.getElementById('selectedOvertimeDateDisplay');
                
                if (dateInput) dateInput.value = dateStr;
                if (display) {
                    const dayNames = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
                    const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
                    display.textContent = `â° ${dayNames[selectedDate.getDay()]}, ${selectedDate.getDate()} ${monthNames[selectedDate.getMonth()]} ${selectedDate.getFullYear()}`;
                    display.style.display = 'block';
                }
            }

            // Update calendar display to show selected date
            setTimeout(() => {
                generateCalendar(type === 'leave' ? leaveCalendarDate : overtimeCalendarDate, 
                               type === 'leave' ? 'leaveCalendarGrid' : 'overtimeCalendarGrid', 
                               type);
            }, 50);
        }

        function generateCalendar(date, gridId, type) {
            const grid = document.getElementById(gridId);
            if (!grid) return;

            const config = window.elementSdk?.config || defaultConfig;
            const baseSize = config.font_size || defaultConfig.font_size;

            const year = date.getFullYear();
            const month = date.getMonth();
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();

            // Get selected date
            const selectedDateInput = document.getElementById(type === 'leave' ? 'selectedLeaveDate' : 'selectedOvertimeDate');
            const selectedDateStr = selectedDateInput ? selectedDateInput.value : '';

            let html = '';

            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDayOfWeek; i++) {
                html += `<div class="calendar-day" style="opacity: 0.3;"></div>`;
            }

            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const currentDate = new Date(year, month, day);
                const dateStr = currentDate.toISOString().split('T')[0];
                const isToday = currentDate.getTime() === today.getTime();
                const isSelected = dateStr === selectedDateStr;
                const isPast = currentDate < today;
                const isWeekend = currentDate.getDay() === 0 || currentDate.getDay() === 6;

                let cellClass = 'calendar-day transition-all duration-200';
                let cellStyle = `font-size: ${baseSize * 0.85}px; min-height: 40px;`;

                if (isPast) {
                    cellClass += ' opacity-40 cursor-not-allowed';
                    cellStyle += `background-color: #f1f5f9; color: ${config.secondary_color};`;
                } else {
                    cellClass += ' cursor-pointer hover:opacity-80';
                    if (isSelected) {
                        cellStyle += `background-color: ${type === 'leave' ? config.primary_color : '#f59e0b'}; color: white; font-weight: bold; border: 2px solid ${type === 'leave' ? config.primary_color : '#f59e0b'};`;
                    } else if (isToday) {
                        cellStyle += `background-color: ${config.background_color}; color: ${config.primary_color}; border: 2px solid ${config.primary_color}; font-weight: bold;`;
                    } else if (isWeekend) {
                        cellStyle += `background-color: #fef3c7; color: #92400e; border: 1px solid #fbbf24;`;
                    } else {
                        cellStyle += `background-color: ${config.surface_color}; color: ${config.text_color}; border: 1px solid #e2e8f0;`;
                    }
                }

                const clickHandler = isPast ? '' : `onclick="selectCalendarDate('${dateStr}', '${type}')"`;

                html += `
                    <div class="${cellClass}" style="${cellStyle}" ${clickHandler}>
                        <div class="flex flex-col items-center justify-center h-full p-1">
                            <span class="font-semibold">${day}</span>
                            ${isToday ? '<div style="font-size: 8px; margin-top: 2px;">Hari ini</div>' : ''}
                            ${isWeekend && !isPast && !isToday ? '<div style="font-size: 8px; margin-top: 2px;">Weekend</div>' : ''}
                            ${isSelected ? '<div style="font-size: 8px; margin-top: 2px;">âœ“ Dipilih</div>' : ''}
                        </div>
                    </div>
                `;
            }

            grid.innerHTML = html;
        }

        async function handleOvertimeReport() {
            const form = document.getElementById('overtimeForm');
            if (!form) return;

            const btn = form.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.innerHTML = '<div class="loading-spinner"></div><span>Melaporkan...</span>';

            const formData = new FormData(form);
            const nik = formData.get('nik');

            // Validate employee exists
            const employee = REFERENCE_EMPLOYEES.find(emp => emp.nik === nik) || 
                           employees.find(emp => emp.nik === nik && emp.status === 'aktif');
            
            if (!employee) {
                showToast('NIK tidak ditemukan', 'error');
                btn.disabled = false;
                btn.innerHTML = 'Laporkan Lembur';
                return;
            }

            // Calculate overtime hours
            const jamMulai = formData.get('jam_mulai');
            const jamSelesai = formData.get('jam_selesai');
            const shiftLembur = formData.get('shift_lembur');
            const startTime = new Date(`2000-01-01T${jamMulai}:00`);
            const endTime = new Date(`2000-01-01T${jamSelesai}:00`);
            
            // Handle overnight overtime
            if (endTime < startTime) {
                endTime.setDate(endTime.getDate() + 1);
            }
            
            const overtimeMinutes = (endTime - startTime) / (1000 * 60);
            const overtimeHours = overtimeMinutes / 60;

            // Calculate rate based on shift type
            let rate = 1.5;
            if (shiftLembur === 'weekend') rate = 2.0;
            if (shiftLembur === 'holiday') rate = 2.5;

            const overtimeData = {
                nik: nik,
                nama: employee.nama,
                posisi: employee.posisi,
                tanggal: formData.get('tanggal'),
                jam_mulai: jamMulai,
                jam_selesai: jamSelesai,
                shift_lembur: shiftLembur,
                total_jam_lembur: overtimeHours,
                rate_lembur: rate,
                poin_lembur: Math.round(overtimeHours * rate * 10),
                pekerjaan: formData.get('pekerjaan'),
                status: 'pending', // pending, approved, rejected
                tanggal_laporan: new Date().toISOString(),
                type: 'overtime_report'
            };

            const result = await window.dataSdk.create(overtimeData);

            if (result.isOk) {
                showToast(`Laporan lembur ${overtimeHours.toFixed(1)} jam (${rate}x rate) berhasil dikirim`, 'success');
                form.reset();
                closeModal('overtimeModal');
            } else {
                showToast('Gagal mengirim laporan lembur', 'error');
            }

            btn.disabled = false;
            btn.innerHTML = 'Laporkan Lembur';
        }

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
                
                // Initialize calendars when modals are opened
                setTimeout(() => {
                    if (modalId === 'leaveRequestModal') {
                        generateCalendar(leaveCalendarDate, 'leaveCalendarGrid', 'leave');
                        updateCalendarHeader(leaveCalendarDate, 'currentMonthLeave');
                        setupCalendarNavigation('leave');
                    } else if (modalId === 'overtimeModal') {
                        generateCalendar(overtimeCalendarDate, 'overtimeCalendarGrid', 'overtime');
                        updateCalendarHeader(overtimeCalendarDate, 'currentMonthOvertime');
                        setupCalendarNavigation('overtime');
                        setupOvertimeCalculation();
                    }
                }, 100);
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
                
                // Reset form and modal state when closing
                const form = modal.querySelector('form');
                if (form) {
                    form.reset();
                }
                
                // Reset NIK field to be editable again
                const nikField = modal.querySelector('[name="nik"]');
                if (nikField) {
                    nikField.readOnly = false;
                }
                
                // Reset modal title
                const modalTitle = modal.querySelector('h2');
                if (modalTitle) {
                    if (modalId === 'leaveRequestModal') {
                        modalTitle.innerHTML = 'Pengajuan Cuti/Ijin';
                    } else if (modalId === 'overtimeModal') {
                        modalTitle.innerHTML = 'Laporan Lembur';
                    }
                }
            }
        }

        function filterAttendance() {
            const dateFilter = document.getElementById('dateFilter')?.value;
            const shiftFilter = document.getElementById('shiftFilter')?.value;
            const nikFilter = document.getElementById('nikFilter')?.value;

            let filtered = [...attendances];

            if (dateFilter) {
                filtered = filtered.filter(att => {
                    const attDate = new Date(att.waktu_absen).toISOString().split('T')[0];
                    return attDate === dateFilter;
                });
            }

            if (shiftFilter) {
                filtered = filtered.filter(att => att.shift_terdeteksi === shiftFilter);
            }

            if (nikFilter) {
                filtered = filtered.filter(att => 
                    att.nik.toLowerCase().includes(nikFilter.toLowerCase()) ||
                    att.nama.toLowerCase().includes(nikFilter.toLowerCase())
                );
            }

            renderAttendanceList(filtered);
        }

        function renderAttendanceList(filteredAttendances) {
            const container = document.getElementById('attendanceList');
            if (!container) return;

            if (filteredAttendances.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ðŸ“‹</div>
                        <p class="text-lg" style="color: ${window.elementSdk?.config?.secondary_color || defaultConfig.secondary_color}">
                            Tidak ada data absensi
                        </p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredAttendances.map(att => `
                <div class="bg-white rounded-xl p-6 shadow-sm card-hover fade-in" style="background-color: ${window.elementSdk?.config?.surface_color || defaultConfig.surface_color}">
                    <div class="flex gap-4">
                        <img src="${att.foto_data}" alt="Foto ${att.nama}" class="w-24 h-24 rounded-lg object-cover">
                        <div class="flex-1">
                            <div class="flex items-start justify-between mb-2">
                                <div>
                                    <h3 class="font-bold text-lg" style="color: ${window.elementSdk?.config?.text_color || defaultConfig.text_color}">${att.nama}</h3>
                                    <p class="text-sm" style="color: ${window.elementSdk?.config?.secondary_color || defaultConfig.secondary_color}">${att.nik} â€¢ ${att.posisi}</p>
                                </div>
                                <span class="status-badge status-${att.status_absen}">
                                    ${att.status_absen === 'hadir' ? 'âœ“ Hadir' : att.status_absen === 'terlambat' ? 'â° Terlambat' : 'âš  Tidak Sesuai Jadwal'}
                                </span>
                            </div>
                            <div class="flex flex-wrap gap-3 mt-3">
                                <div class="flex items-center gap-2">
                                    <span class="text-2xl">ðŸ•</span>
                                    <span class="text-sm font-medium" style="color: ${window.elementSdk?.config?.text_color || defaultConfig.text_color}">
                                        ${formatDate(att.waktu_absen)} ${formatTime(att.waktu_absen)}
                                    </span>
                                </div>
                                <span class="shift-badge shift-${att.shift_terdeteksi}">
                                    ${getShiftLabel(att.shift_terdeteksi)}
                                </span>
                                ${att.shift_terdeteksi !== att.shift_jadwal ? `
                                    <span class="text-xs px-2 py-1 rounded" style="background-color: #fee2e2; color: #991b1b">
                                        Jadwal: ${getShiftLabel(att.shift_jadwal)}
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderRosterCalendar() {
            const container = document.getElementById('rosterCalendar');
            if (!container) return;

            const config = window.elementSdk?.config || defaultConfig;
            const baseSize = config.font_size || defaultConfig.font_size;

            // Get current week dates
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());

            const weekDates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                weekDates.push(date);
            }

            const dayNames = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];

            // Group roster by employee
            const rosterByEmployee = {};
            REFERENCE_EMPLOYEES.forEach(emp => {
                rosterByEmployee[emp.nik] = {
                    nama: emp.nama,
                    posisi: emp.posisi,
                    shifts: {},
                    records: {}
                };
            });

            rosters.forEach(roster => {
                if (rosterByEmployee[roster.nik]) {
                    rosterByEmployee[roster.nik].shifts[roster.tanggal] = roster.shift_roster;
                    rosterByEmployee[roster.nik].records[roster.tanggal] = roster;
                }
            });

            let html = `
                <div class="roster-grid">
                    <div class="roster-name" style="background-color: ${config.primary_color}; color: white; font-size: ${baseSize * 0.9}px;">
                        Karyawan
                    </div>
            `;

            // Header days
            weekDates.forEach((date, index) => {
                const isToday = date.toDateString() === today.toDateString();
                html += `
                    <div class="roster-cell" style="background-color: ${config.primary_color}; color: white; font-size: ${baseSize * 0.85}px; ${isToday ? 'border: 2px solid #fbbf24;' : ''}">
                        <div>
                            <div>${dayNames[index]}</div>
                            <div style="font-size: ${baseSize * 0.75}px;">${date.getDate()}/${date.getMonth() + 1}</div>
                        </div>
                    </div>
                `;
            });

            // Employee rows
            Object.entries(rosterByEmployee).forEach(([nik, empData]) => {
                html += `
                    <div class="roster-name" style="background-color: ${config.surface_color}; color: ${config.text_color}; font-size: ${baseSize * 0.85}px; border: 1px solid #e2e8f0;">
                        <div>
                            <div class="font-semibold">${empData.nama}</div>
                            <div style="font-size: ${baseSize * 0.75}px; color: ${config.secondary_color};">${empData.posisi}</div>
                        </div>
                    </div>
                `;

                weekDates.forEach(date => {
                    const dateStr = date.toISOString().split('T')[0];
                    const shift = empData.shifts[dateStr] || '-';
                    const rosterRecord = empData.records[dateStr];
                    const isToday = date.toDateString() === today.toDateString();
                    
                    let cellClass = 'roster-cell cursor-pointer hover:opacity-80 transition-opacity';
                    let cellStyle = `font-size: ${baseSize * 0.8}px; border: 1px solid #e2e8f0;`;
                    
                    if (shift === 'OFF') {
                        cellStyle += 'background-color: #f1f5f9; color: #64748b;';
                    } else if (shift === 'CUTI') {
                        cellStyle += 'background-color: #fef3c7; color: #92400e;';
                    } else if (shift === '1') {
                        cellStyle += 'background-color: #dbeafe; color: #1e40af;';
                    } else if (shift === '2') {
                        cellStyle += 'background-color: #fef3c7; color: #92400e;';
                    } else if (shift === '3') {
                        cellStyle += 'background-color: #e0e7ff; color: #3730a3;';
                    } else {
                        cellStyle += `background-color: ${config.surface_color}; color: ${config.secondary_color};`;
                    }

                    if (isToday) {
                        cellStyle += 'border: 2px solid #fbbf24;';
                    }

                    const displayText = shift === 'OFF' ? 'LIBUR' : 
                                      shift === 'CUTI' ? 'CUTI' : 
                                      shift === '-' ? '-' : 
                                      getShiftLabel(shift);

                    const clickHandler = rosterRecord ? `onclick="openEditRosterModal('${rosterRecord.__backendId}', '${nik}', '${empData.nama}', '${dateStr}', '${shift}')"` : '';

                    html += `
                        <div class="${cellClass}" style="${cellStyle}" ${clickHandler} title="${rosterRecord ? 'Klik untuk edit' : 'Belum ada roster'}">
                            <div class="flex flex-col items-center">
                                <div>${displayText}</div>
                                ${rosterRecord ? '<div style="font-size: 10px; opacity: 0.7;">âœï¸</div>' : ''}
                            </div>
                        </div>
                    `;
                });
            });

            html += '</div>';

            if (Object.keys(rosterByEmployee).length === 0 || rosters.length === 0) {
                html = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ðŸ“…</div>
                        <p class="text-lg mb-4" style="color: ${config.secondary_color}">
                            Belum ada roster kerja
                        </p>
                        <button id="generateRosterBtn" onclick="generateAndSaveRoster()" class="px-6 py-3 rounded-xl font-semibold text-white" style="background-color: ${config.primary_color}; font-size: ${baseSize}px">
                            ðŸ“… Generate Roster Mingguan
                        </button>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function renderWorkHoursReport() {
            const container = document.getElementById('workHoursReport');
            if (!container) return;

            const config = window.elementSdk?.config || defaultConfig;
            const baseSize = config.font_size || defaultConfig.font_size;

            const monthFilter = document.getElementById('monthFilter');
            const yearFilter = document.getElementById('yearFilter');
            const selectedMonth = monthFilter ? parseInt(monthFilter.value) : new Date().getMonth();
            const selectedYear = yearFilter ? parseInt(yearFilter.value) : new Date().getFullYear();

            const monthlyData = getAllEmployeesMonthlyHours(selectedMonth, selectedYear);
            const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];

            if (monthlyData.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">â°</div>
                        <p class="text-lg" style="color: ${config.secondary_color}; font-size: ${baseSize}px">
                            Belum ada data jam kerja untuk ${monthNames[selectedMonth]} ${selectedYear}
                        </p>
                    </div>
                `;
                return;
            }

            const totalAllHours = monthlyData.reduce((sum, emp) => sum + emp.totalHours, 0);
            const averageHours = totalAllHours / monthlyData.length;

            container.innerHTML = `
                <div class="mb-6">
                    <h3 class="font-bold mb-4" style="font-size: ${baseSize * 1.1}px; color: ${config.text_color}">
                        Ringkasan ${monthNames[selectedMonth]} ${selectedYear}
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="rounded-lg p-4" style="background-color: ${config.background_color}">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-2xl">â±ï¸</span>
                                <span class="font-medium" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Total Jam Kerja</span>
                            </div>
                            <p class="font-bold" style="font-size: ${baseSize * 1.5}px; color: ${config.primary_color}">${totalAllHours.toFixed(1)} jam</p>
                        </div>
                        <div class="rounded-lg p-4" style="background-color: ${config.background_color}">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-2xl">ðŸ“Š</span>
                                <span class="font-medium" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Rata-rata per Karyawan</span>
                            </div>
                            <p class="font-bold" style="font-size: ${baseSize * 1.5}px; color: ${config.primary_color}">${averageHours.toFixed(1)} jam</p>
                        </div>
                        <div class="rounded-lg p-4" style="background-color: ${config.background_color}">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-2xl">ðŸ‘¥</span>
                                <span class="font-medium" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Karyawan Aktif</span>
                            </div>
                            <p class="font-bold" style="font-size: ${baseSize * 1.5}px; color: ${config.primary_color}">${monthlyData.filter(emp => emp.totalHours > 0).length}</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-3">
                    <h4 class="font-semibold" style="font-size: ${baseSize}px; color: ${config.text_color}">Detail per Karyawan</h4>
                    ${monthlyData.map(emp => `
                        <div class="rounded-lg p-4 border-2" style="border-color: #e2e8f0; background-color: ${config.surface_color}">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-2">
                                        <h5 class="font-semibold" style="font-size: ${baseSize}px; color: ${config.text_color}">${emp.nama}</h5>
                                        <span class="px-2 py-1 rounded text-xs font-medium" style="background-color: ${config.background_color}; color: ${config.secondary_color}">${emp.nik}</span>
                                        <span class="px-2 py-1 rounded text-xs font-medium" style="background-color: ${config.primary_color}; color: white">${emp.posisi}</span>
                                    </div>
                                    <div class="grid grid-cols-3 gap-4 text-sm">
                                        <div>
                                            <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Total Jam:</span>
                                            <span class="font-semibold ml-1" style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px">${emp.totalHours} jam</span>
                                        </div>
                                        <div>
                                            <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Hari Kerja:</span>
                                            <span class="font-semibold ml-1" style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px">${emp.totalDays} hari</span>
                                        </div>
                                        <div>
                                            <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Rata-rata:</span>
                                            <span class="font-semibold ml-1" style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px">${emp.averageHours} jam/hari</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="w-16 h-16 rounded-full flex items-center justify-center" style="background-color: ${emp.totalHours >= 160 ? '#dcfce7' : emp.totalHours >= 120 ? '#fef3c7' : '#fee2e2'}">
                                        <span class="font-bold" style="font-size: ${baseSize * 0.8}px; color: ${emp.totalHours >= 160 ? '#166534' : emp.totalHours >= 120 ? '#92400e' : '#991b1b'}">${emp.totalHours}h</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderDailyWorkHours() {
            const container = document.getElementById('dailyWorkHours');
            if (!container) return;

            const config = window.elementSdk?.config || defaultConfig;
            const baseSize = config.font_size || defaultConfig.font_size;

            const employeeFilter = document.getElementById('employeeFilter');
            const monthYearFilter = document.getElementById('monthYearFilter');
            
            const selectedNik = employeeFilter ? employeeFilter.value : '';
            const selectedMonthYear = monthYearFilter ? monthYearFilter.value : '';

            if (!selectedNik || !selectedMonthYear) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <p style="color: ${config.secondary_color}; font-size: ${baseSize * 0.9}px">
                            Pilih karyawan dan bulan untuk melihat detail jam kerja harian
                        </p>
                    </div>
                `;
                return;
            }

            const [year, month] = selectedMonthYear.split('-');
            const targetMonth = parseInt(month) - 1; // JavaScript months are 0-indexed
            const targetYear = parseInt(year);

            const employeeWorkHours = workHours.filter(wh => {
                const workDate = new Date(wh.tanggal);
                return wh.nik === selectedNik && 
                       workDate.getMonth() === targetMonth && 
                       workDate.getFullYear() === targetYear;
            }).sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));

            const employee = REFERENCE_EMPLOYEES.find(emp => emp.nik === selectedNik);
            const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];

            if (employeeWorkHours.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-4xl mb-3">ðŸ“…</div>
                        <p style="color: ${config.secondary_color}; font-size: ${baseSize}px">
                            Belum ada data jam kerja untuk ${employee?.nama || selectedNik} di ${monthNames[targetMonth]} ${targetYear}
                        </p>
                    </div>
                `;
                return;
            }

            const totalHours = employeeWorkHours.reduce((sum, wh) => sum + wh.total_jam, 0);
            const averageHours = totalHours / employeeWorkHours.length;

            container.innerHTML = `
                <div class="mb-4">
                    <h4 class="font-semibold mb-3" style="font-size: ${baseSize * 1.1}px; color: ${config.text_color}">
                        ${employee?.nama || selectedNik} - ${monthNames[targetMonth]} ${targetYear}
                    </h4>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="rounded-lg p-3" style="background-color: ${config.background_color}">
                            <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Total Jam Kerja:</span>
                            <p class="font-bold" style="color: ${config.primary_color}; font-size: ${baseSize * 1.2}px">${totalHours.toFixed(1)} jam</p>
                        </div>
                        <div class="rounded-lg p-3" style="background-color: ${config.background_color}">
                            <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Rata-rata per Hari:</span>
                            <p class="font-bold" style="color: ${config.primary_color}; font-size: ${baseSize * 1.2}px">${averageHours.toFixed(1)} jam</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-2">
                    ${employeeWorkHours.map(wh => {
                        const workDate = new Date(wh.tanggal);
                        const checkinTime = new Date(wh.jam_masuk);
                        const checkoutTime = new Date(wh.jam_keluar);
                        
                        return `
                            <div class="rounded-lg p-4 border" style="border-color: #e2e8f0; background-color: ${config.surface_color}">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="font-semibold" style="color: ${config.text_color}; font-size: ${baseSize}px">
                                                ${workDate.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long' })}
                                            </span>
                                            <span class="shift-badge shift-${wh.shift}" style="font-size: ${baseSize * 0.8}px">
                                                ${getShiftLabel(wh.shift)}
                                            </span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-4 text-sm">
                                            <div>
                                                <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Masuk:</span>
                                                <p class="font-medium" style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px">${formatTime(wh.jam_masuk)}</p>
                                            </div>
                                            <div>
                                                <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Keluar:</span>
                                                <p class="font-medium" style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px">${formatTime(wh.jam_keluar)}</p>
                                            </div>
                                            <div>
                                                <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Durasi:</span>
                                                <p class="font-medium" style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px">${Math.floor(wh.total_jam)}j ${Math.round((wh.total_jam % 1) * 60)}m</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="px-3 py-2 rounded-lg" style="background-color: ${wh.total_jam >= 8 ? '#dcfce7' : wh.total_jam >= 6 ? '#fef3c7' : '#fee2e2'}">
                                            <span class="font-bold" style="font-size: ${baseSize}px; color: ${wh.total_jam >= 8 ? '#166534' : wh.total_jam >= 6 ? '#92400e' : '#991b1b'}">${wh.total_jam.toFixed(1)}h</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function exportToCSV() {
            const headers = ['NIK', 'Nama', 'Posisi', 'Tanggal', 'Waktu', 'Shift Terdeteksi', 'Shift Jadwal', 'Status', 'Lokasi'];
            const rows = attendances.map(att => [
                att.nik,
                att.nama,
                att.posisi,
                formatDate(att.waktu_absen),
                formatTime(att.waktu_absen),
                getShiftLabel(att.shift_terdeteksi),
                getShiftLabel(att.shift_jadwal),
                att.status_absen,
                att.lokasi
            ]);

            let csv = headers.join(',') + '\n';
            rows.forEach(row => {
                csv += row.map(cell => `"${cell}"`).join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `absensi_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);

            showToast('Laporan berhasil diunduh', 'success');
        }

        function filterProfiles() {
            const positionFilter = document.getElementById('profileFilter')?.value;
            const searchFilter = document.getElementById('profileSearch')?.value?.toLowerCase();

            let filtered = [...REFERENCE_EMPLOYEES];

            if (positionFilter) {
                filtered = filtered.filter(emp => emp.posisi === positionFilter);
            }

            if (searchFilter) {
                filtered = filtered.filter(emp => 
                    emp.nama.toLowerCase().includes(searchFilter) ||
                    emp.nik.toLowerCase().includes(searchFilter)
                );
            }

            renderProfilesList(filtered);
        }

        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }

        function calculateWorkYears(joinDate) {
            const today = new Date();
            const join = new Date(joinDate);
            let years = today.getFullYear() - join.getFullYear();
            const monthDiff = today.getMonth() - join.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < join.getDate())) {
                years--;
            }
            
            return years;
        }

        function getEmployeeStats(nik) {
            const empAttendances = attendances.filter(att => att.nik === nik);
            const totalAbsensi = empAttendances.length;
            const hadirCount = empAttendances.filter(att => att.status_absen === 'hadir').length;
            const terlambatCount = empAttendances.filter(att => att.status_absen === 'terlambat').length;
            const tidakSesuaiCount = empAttendances.filter(att => att.status_absen === 'tidak-sesuai').length;

            return {
                total: totalAbsensi,
                hadir: hadirCount,
                terlambat: terlambatCount,
                tidakSesuai: tidakSesuaiCount,
                tingkatKehadiran: totalAbsensi > 0 ? Math.round((hadirCount / totalAbsensi) * 100) : 0
            };
        }

        function getMonthlyWorkHours(nik, month = null, year = null) {
            const now = new Date();
            const targetMonth = month !== null ? month : now.getMonth();
            const targetYear = year !== null ? year : now.getFullYear();

            const monthlyHours = workHours.filter(wh => {
                const workDate = new Date(wh.tanggal);
                return wh.nik === nik && 
                       workDate.getMonth() === targetMonth && 
                       workDate.getFullYear() === targetYear;
            });

            const totalHours = monthlyHours.reduce((sum, wh) => sum + (wh.total_jam || 0), 0);
            const totalDays = monthlyHours.length;
            const averageHours = totalDays > 0 ? totalHours / totalDays : 0;

            return {
                totalHours: Math.round(totalHours * 100) / 100,
                totalDays,
                averageHours: Math.round(averageHours * 100) / 100,
                records: monthlyHours
            };
        }

        function getAllEmployeesMonthlyHours(month = null, year = null) {
            const now = new Date();
            const targetMonth = month !== null ? month : now.getMonth();
            const targetYear = year !== null ? year : now.getFullYear();

            const allEmployees = [...REFERENCE_EMPLOYEES, ...employees.filter(e => e.status === 'aktif')];
            const uniqueEmployees = allEmployees.filter((emp, index, self) => 
                index === self.findIndex(e => e.nik === emp.nik)
            );

            return uniqueEmployees.map(emp => {
                const monthlyData = getMonthlyWorkHours(emp.nik, targetMonth, targetYear);
                return {
                    nik: emp.nik,
                    nama: emp.nama,
                    posisi: emp.posisi,
                    ...monthlyData
                };
            }).sort((a, b) => b.totalHours - a.totalHours);
        }

        function renderProfilesList(filteredProfiles) {
            const container = document.getElementById('profilesList');
            if (!container) return;

            const config = window.elementSdk?.config || defaultConfig;
            const baseSize = config.font_size || defaultConfig.font_size;

            if (filteredProfiles.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-6xl mb-4">ðŸ‘¤</div>
                        <p class="text-lg" style="color: ${config.secondary_color}; font-size: ${baseSize}px">
                            Tidak ada profil karyawan yang ditemukan
                        </p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredProfiles.map(emp => {
                const stats = getEmployeeStats(emp.nik);
                const age = calculateAge(emp.tanggal_lahir);
                const workYears = calculateWorkYears(emp.tanggal_bergabung);

                return `
                    <div class="rounded-xl p-6 shadow-sm card-hover fade-in" style="background-color: ${config.surface_color}">
                        <div class="flex items-start gap-4 mb-4">
                            <img src="${emp.foto_profil}" alt="Foto ${emp.nama}" class="w-20 h-20 rounded-full object-cover">
                            <div class="flex-1">
                                <h3 class="font-bold mb-1" style="font-size: ${baseSize * 1.2}px; color: ${config.text_color}">${emp.nama}</h3>
                                <p class="font-medium mb-1" style="font-size: ${baseSize * 0.9}px; color: ${config.primary_color}">${emp.posisi}</p>
                                <p style="font-size: ${baseSize * 0.85}px; color: ${config.secondary_color}">${emp.nik}</p>
                                <span class="shift-badge shift-${emp.shift_tetap} mt-2 inline-block" style="font-size: ${baseSize * 0.8}px">
                                    ${getShiftLabel(emp.shift_tetap)}
                                </span>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <div class="grid grid-cols-2 gap-3">
                                <div class="rounded-lg p-3" style="background-color: ${config.background_color}">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="text-lg">ðŸŽ‚</span>
                                        <span class="font-medium" style="font-size: ${baseSize * 0.85}px; color: ${config.text_color}">Usia</span>
                                    </div>
                                    <p class="font-bold" style="font-size: ${baseSize}px; color: ${config.primary_color}">${age} tahun</p>
                                </div>
                                <div class="rounded-lg p-3" style="background-color: ${config.background_color}">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="text-lg">ðŸ’¼</span>
                                        <span class="font-medium" style="font-size: ${baseSize * 0.85}px; color: ${config.text_color}">Masa Kerja</span>
                                    </div>
                                    <p class="font-bold" style="font-size: ${baseSize}px; color: ${config.primary_color}">${workYears} tahun</p>
                                </div>
                            </div>

                            <div class="rounded-lg p-3" style="background-color: ${config.background_color}">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-lg">ðŸ“Š</span>
                                    <span class="font-medium" style="font-size: ${baseSize * 0.85}px; color: ${config.text_color}">Statistik Absensi</span>
                                </div>
                                <div class="grid grid-cols-2 gap-2 text-center">
                                    <div>
                                        <p class="font-bold" style="font-size: ${baseSize * 1.1}px; color: ${config.primary_color}">${stats.tingkatKehadiran}%</p>
                                        <p style="font-size: ${baseSize * 0.75}px; color: ${config.secondary_color}">Kehadiran</p>
                                    </div>
                                    <div>
                                        <p class="font-bold" style="font-size: ${baseSize * 1.1}px; color: ${config.text_color}">${stats.total}</p>
                                        <p style="font-size: ${baseSize * 0.75}px; color: ${config.secondary_color}">Total Absen</p>
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-sm">ðŸ“§</span>
                                    <span style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">${emp.email}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm">ðŸ“±</span>
                                    <span style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">${emp.telepon}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm">ðŸ </span>
                                    <span style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">${emp.alamat}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm">ðŸŽ“</span>
                                    <span style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">${emp.pendidikan}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm">${emp.status_pernikahan === 'Menikah' ? 'ðŸ’‘' : 'ðŸ‘¤'}</span>
                                    <span style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">${emp.status_pernikahan}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm">ðŸš¨</span>
                                    <span style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">${emp.kontak_darurat}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-sm">ðŸ“…</span>
                                    <span style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">Bergabung: ${formatDate(emp.tanggal_bergabung)}</span>
                                </div>
                            </div>

                            <div class="mt-4 pt-4 border-t" style="border-color: ${config.background_color}">
                                <button onclick="openEditEmployeeModal(${JSON.stringify(emp).replace(/"/g, '&quot;')})" class="w-full px-4 py-2 rounded-lg font-medium text-white flex items-center justify-center gap-2" style="background-color: ${config.primary_color}; font-size: ${baseSize * 0.9}px">
                                    <span>âœï¸</span>
                                    <span>Edit Profil</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function render() {
            const config = window.elementSdk?.config || defaultConfig;
            const app = document.getElementById('app');
            
            const customFont = config.font_family || defaultConfig.font_family;
            const baseSize = config.font_size || defaultConfig.font_size;
            const baseFontStack = 'system-ui, -apple-system, sans-serif';

            document.body.style.backgroundColor = config.background_color || defaultConfig.background_color;
            document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
            document.body.style.fontSize = `${baseSize}px`;
            document.body.style.color = config.text_color || defaultConfig.text_color;

            if (currentView === 'login') {
                app.innerHTML = `
                    <div class="min-h-full flex items-center justify-center p-6">
                        <div class="w-full max-w-md fade-in">
                            <div class="text-center mb-8">
                                <div class="text-6xl mb-4">ðŸ‘”</div>
                                <h1 class="font-bold mb-2" style="font-size: ${baseSize * 2}px; color: ${config.text_color}">${config.app_title}</h1>
                                <p style="font-size: ${baseSize * 0.9}px; color: ${config.secondary_color}">${config.company_tagline}</p>
                            </div>
                            <div class="rounded-2xl p-8 shadow-xl" style="background-color: ${config.surface_color}">
                                <h2 class="font-bold mb-6 text-center" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Pilih Mode Akses</h2>
                                <div class="space-y-4">
                                    <button onclick="handleLogin('employee')" class="w-full btn-primary rounded-xl py-4 font-semibold text-white flex items-center justify-center gap-3" style="background-color: ${config.primary_color}; font-size: ${baseSize * 1.1}px">
                                        <span class="text-2xl">ðŸ‘¤</span>
                                        <span>Absensi Karyawan</span>
                                    </button>
                                    <button onclick="handleLogin('admin')" class="w-full btn-primary rounded-xl py-4 font-semibold text-white flex items-center justify-center gap-3" style="background-color: ${config.secondary_color}; font-size: ${baseSize * 1.1}px">
                                        <span class="text-2xl">âš™ï¸</span>
                                        <span>Dashboard Admin</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentView === 'attendance') {
                app.innerHTML = `
                    <div class="min-h-full p-6">
                        <div class="max-w-2xl mx-auto">
                            <div class="flex items-center justify-between mb-8">
                                <div>
                                    <h1 class="font-bold mb-1" style="font-size: ${baseSize * 1.8}px; color: ${config.text_color}">Portal Karyawan</h1>
                                    <p style="font-size: ${baseSize * 0.9}px; color: ${config.secondary_color}">Absensi, Cuti & Lembur</p>
                                </div>
                                <button onclick="handleBackToLogin()" class="px-4 py-2 rounded-lg font-medium" style="background-color: ${config.surface_color}; color: ${config.secondary_color}; font-size: ${baseSize * 0.9}px">
                                    â† Kembali
                                </button>
                            </div>
                            
                            <div class="space-y-6">
                                <!-- Absensi Card -->
                                <div class="rounded-2xl p-8 shadow-xl fade-in" style="background-color: ${config.surface_color}">
                                    <div class="text-center mb-6">
                                        <div class="text-6xl mb-4">ðŸŽ¯</div>
                                        <h2 class="font-bold mb-2" style="font-size: ${baseSize * 1.5}px; color: ${config.text_color}">Absensi Harian</h2>
                                        <p style="font-size: ${baseSize * 0.9}px; color: ${config.secondary_color}">Masukkan NIK untuk absensi masuk/keluar</p>
                                    </div>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block font-semibold mb-2" style="font-size: ${baseSize}px; color: ${config.text_color}">Nomor Induk Karyawan (NIK)</label>
                                            <input type="text" id="nikInput" placeholder="Contoh: EMP001" class="w-full px-4 py-4 rounded-xl border-2 focus:outline-none focus:border-blue-500" style="font-size: ${baseSize * 1.1}px; border-color: #e2e8f0">
                                        </div>
                                        <button onclick="handleNIKSubmit()" class="w-full btn-primary rounded-xl py-4 font-bold text-white" style="background-color: ${config.primary_color}; font-size: ${baseSize * 1.1}px">
                                            Lanjutkan Absensi â†’
                                        </button>
                                    </div>
                                </div>

                                <!-- Pengajuan Cuti/Ijin Card -->
                                <div class="rounded-2xl p-8 shadow-xl fade-in" style="background-color: ${config.surface_color}">
                                    <div class="text-center mb-6">
                                        <div class="text-6xl mb-4">ðŸ“</div>
                                        <h2 class="font-bold mb-2" style="font-size: ${baseSize * 1.5}px; color: ${config.text_color}">Pengajuan Cuti & Ijin</h2>
                                        <p style="font-size: ${baseSize * 0.9}px; color: ${config.secondary_color}">Ajukan permohonan cuti atau ijin kerja</p>
                                    </div>
                                    <button onclick="openLeaveModalWithNIK()" class="w-full btn-primary rounded-xl py-4 font-bold text-white flex items-center justify-center gap-3" style="background-color: ${config.secondary_color}; font-size: ${baseSize * 1.1}px">
                                        <span>ðŸ“‹</span>
                                        <span>Ajukan Cuti/Ijin</span>
                                    </button>
                                </div>

                                <!-- Laporan Lembur Card -->
                                <div class="rounded-2xl p-8 shadow-xl fade-in" style="background-color: ${config.surface_color}">
                                    <div class="text-center mb-6">
                                        <div class="text-6xl mb-4">â°</div>
                                        <h2 class="font-bold mb-2" style="font-size: ${baseSize * 1.5}px; color: ${config.text_color}">Laporan Lembur</h2>
                                        <p style="font-size: ${baseSize * 0.9}px; color: ${config.secondary_color}">Laporkan jam kerja lembur Anda</p>
                                    </div>
                                    <button onclick="openOvertimeModalWithNIK()" class="w-full btn-primary rounded-xl py-4 font-bold text-white flex items-center justify-center gap-3" style="background-color: #f59e0b; font-size: ${baseSize * 1.1}px">
                                        <span>â±ï¸</span>
                                        <span>Lapor Lembur</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Leave Request Modal -->
                    <div id="leaveRequestModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-6 modal-backdrop">
                        <div class="rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl fade-in" style="background-color: ${config.surface_color}">
                            <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Pengajuan Cuti/Ijin</h2>
                            <form id="leaveRequestForm" class="space-y-6" onsubmit="event.preventDefault(); handleLeaveRequest();">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">NIK *</label>
                                        <input type="text" name="nik" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Contoh: EMP001">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Jenis Permohonan *</label>
                                        <select name="leave_type" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                            <option value="">Pilih Jenis</option>
                                            <option value="cuti">Cuti Tahunan</option>
                                            <option value="ijin">Ijin Khusus</option>
                                            <option value="sakit">Sakit</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Calendar Section -->
                                <div>
                                    <label class="block font-semibold mb-3" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Pilih Tanggal Cuti/Ijin *</label>
                                    <div class="rounded-lg p-4 border-2" style="border-color: #e2e8f0; background-color: ${config.background_color}">
                                        <div class="flex items-center justify-between mb-4">
                                            <button type="button" id="prevMonthLeave" class="px-3 py-2 rounded-lg font-semibold" style="background-color: ${config.surface_color}; color: ${config.text_color}; font-size: ${baseSize * 0.9}px">â€¹</button>
                                            <h3 id="currentMonthLeave" class="font-bold" style="font-size: ${baseSize * 1.1}px; color: ${config.text_color}"></h3>
                                            <button type="button" id="nextMonthLeave" class="px-3 py-2 rounded-lg font-semibold" style="background-color: ${config.surface_color}; color: ${config.text_color}; font-size: ${baseSize * 0.9}px">â€º</button>
                                        </div>
                                        <div class="calendar-header">
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Min</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Sen</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Sel</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Rab</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Kam</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Jum</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Sab</div>
                                        </div>
                                        <div id="leaveCalendarGrid" class="calendar-grid"></div>
                                    </div>
                                    <input type="hidden" name="tanggal" id="selectedLeaveDate" required>
                                    <div id="selectedLeaveDateDisplay" class="mt-2 text-center font-medium" style="color: ${config.primary_color}; font-size: ${baseSize * 0.9}px"></div>
                                </div>

                                <div>
                                    <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Alasan *</label>
                                    <textarea name="alasan" required rows="3" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Jelaskan alasan cuti/ijin"></textarea>
                                </div>

                                <div class="flex gap-3 pt-4">
                                    <button type="button" onclick="closeModal('leaveRequestModal')" class="flex-1 px-4 py-3 rounded-lg font-semibold" style="background-color: #e2e8f0; color: ${config.secondary_color}; font-size: ${baseSize}px">
                                        Batal
                                    </button>
                                    <button type="submit" class="flex-1 px-4 py-3 rounded-lg font-semibold text-white" style="background-color: ${config.primary_color}; font-size: ${baseSize}px">
                                        Ajukan Cuti/Ijin
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Overtime Modal -->
                    <div id="overtimeModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-6 modal-backdrop">
                        <div class="rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl fade-in" style="background-color: ${config.surface_color}">
                            <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Laporan Lembur</h2>
                            <form id="overtimeForm" class="space-y-6" onsubmit="event.preventDefault(); handleOvertimeReport();">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">NIK *</label>
                                        <input type="text" name="nik" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Contoh: EMP001">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Shift Lembur *</label>
                                        <select name="shift_lembur" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                            <option value="">Pilih Shift</option>
                                            <option value="1">${config.shift1_label || 'Shift Pagi'} (08:00-16:00)</option>
                                            <option value="2">${config.shift2_label || 'Shift Sore'} (16:00-24:00)</option>
                                            <option value="3">${config.shift3_label || 'Shift Malam'} (00:00-08:00)</option>
                                            <option value="weekend">Lembur Weekend</option>
                                            <option value="holiday">Lembur Hari Libur</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Calendar Section -->
                                <div>
                                    <label class="block font-semibold mb-3" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Pilih Tanggal Lembur *</label>
                                    <div class="rounded-lg p-4 border-2" style="border-color: #e2e8f0; background-color: ${config.background_color}">
                                        <div class="flex items-center justify-between mb-4">
                                            <button type="button" id="prevMonthOvertime" class="px-3 py-2 rounded-lg font-semibold" style="background-color: ${config.surface_color}; color: ${config.text_color}; font-size: ${baseSize * 0.9}px">â€¹</button>
                                            <h3 id="currentMonthOvertime" class="font-bold" style="font-size: ${baseSize * 1.1}px; color: ${config.text_color}"></h3>
                                            <button type="button" id="nextMonthOvertime" class="px-3 py-2 rounded-lg font-semibold" style="background-color: ${config.surface_color}; color: ${config.text_color}; font-size: ${baseSize * 0.9}px">â€º</button>
                                        </div>
                                        <div class="calendar-header">
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Min</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Sen</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Sel</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Rab</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Kam</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Jum</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Sab</div>
                                        </div>
                                        <div id="overtimeCalendarGrid" class="calendar-grid"></div>
                                    </div>
                                    <input type="hidden" name="tanggal" id="selectedOvertimeDate" required>
                                    <div id="selectedOvertimeDateDisplay" class="mt-2 text-center font-medium" style="color: #f59e0b; font-size: ${baseSize * 0.9}px"></div>
                                </div>

                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Jam Mulai Lembur *</label>
                                        <input type="time" name="jam_mulai" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Jam Selesai Lembur *</label>
                                        <input type="time" name="jam_selesai" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                </div>

                                <div id="overtimeHoursCalculation" class="rounded-lg p-4" style="background-color: ${config.background_color}; display: none;">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-2xl">â±ï¸</span>
                                        <span class="font-semibold" style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px">Kalkulasi Jam Lembur</span>
                                    </div>
                                    <div class="grid grid-cols-3 gap-4 text-center">
                                        <div>
                                            <p class="font-bold" style="color: #f59e0b; font-size: ${baseSize * 1.2}px" id="totalOvertimeHours">0.0</p>
                                            <p style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Total Jam</p>
                                        </div>
                                        <div>
                                            <p class="font-bold" style="color: ${config.primary_color}; font-size: ${baseSize * 1.2}px" id="overtimeRate">1.5x</p>
                                            <p style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Rate</p>
                                        </div>
                                        <div>
                                            <p class="font-bold" style="color: #22c55e; font-size: ${baseSize * 1.2}px" id="overtimePoints">0</p>
                                            <p style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Poin</p>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Pekerjaan yang Dilakukan *</label>
                                    <textarea name="pekerjaan" required rows="3" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Jelaskan detail pekerjaan lembur yang dilakukan"></textarea>
                                </div>

                                <div class="flex gap-3 pt-4">
                                    <button type="button" onclick="closeModal('overtimeModal')" class="flex-1 px-4 py-3 rounded-lg font-semibold" style="background-color: #e2e8f0; color: ${config.secondary_color}; font-size: ${baseSize}px">
                                        Batal
                                    </button>
                                    <button type="submit" class="flex-1 px-4 py-3 rounded-lg font-semibold text-white" style="background-color: #f59e0b; font-size: ${baseSize}px">
                                        Laporkan Lembur
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
            } else if (currentView === 'employee_dashboard') {
                const employee = window.currentEmployee;
                if (!employee) {
                    currentView = 'attendance';
                    render();
                    return;
                }

                // Get today's roster
                const today = new Date().toISOString().split('T')[0];
                const todayRoster = rosters.find(r => r.nik === employee.nik && r.tanggal === today);
                
                // Get today's attendance records
                const todayAttendances = attendances.filter(att => {
                    const attDate = new Date(att.waktu_absen).toISOString().split('T')[0];
                    return attDate === today && att.nik === employee.nik;
                });

                // Check attendance status
                const hasCheckedIn = todayAttendances.some(att => att.attendance_type === 'checkin');
                const hasCheckedOut = todayAttendances.some(att => att.attendance_type === 'checkout');
                const lastAttendance = todayAttendances[todayAttendances.length - 1];

                // Get employee's leave requests
                const employeeLeaves = leaveRequests.filter(req => req.nik === employee.nik)
                    .sort((a, b) => new Date(b.tanggal_pengajuan) - new Date(a.tanggal_pengajuan))
                    .slice(0, 5);

                // Get employee's overtime reports
                const employeeOvertimes = overtimeReports.filter(rep => rep.nik === employee.nik)
                    .sort((a, b) => new Date(b.tanggal_laporan) - new Date(a.tanggal_laporan))
                    .slice(0, 5);

                // Get this week's roster
                const startOfWeek = new Date();
                startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());
                const weekRoster = [];
                for (let i = 0; i < 7; i++) {
                    const date = new Date(startOfWeek);
                    date.setDate(startOfWeek.getDate() + i);
                    const dateStr = date.toISOString().split('T')[0];
                    const roster = rosters.find(r => r.nik === employee.nik && r.tanggal === dateStr);
                    weekRoster.push({
                        date: dateStr,
                        day: date.toLocaleDateString('id-ID', { weekday: 'short' }),
                        dayNum: date.getDate(),
                        shift: roster ? roster.shift_roster : '-',
                        isToday: dateStr === today
                    });
                }

                // Get work hours summary for current month
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                const monthlyHours = getMonthlyWorkHours(employee.nik, currentMonth, currentYear);

                app.innerHTML = `
                    <div class="min-h-full p-6">
                        <div class="max-w-6xl mx-auto">
                            <!-- Header -->
                            <div class="flex items-center justify-between mb-8">
                                <div class="flex items-center gap-4">
                                    <img src="${employee.foto_profil}" alt="Foto ${employee.nama}" class="w-16 h-16 rounded-full object-cover">
                                    <div>
                                        <h1 class="font-bold mb-1" style="font-size: ${baseSize * 1.8}px; color: ${config.text_color}">Selamat Datang, ${employee.nama}!</h1>
                                        <p style="font-size: ${baseSize * 0.9}px; color: ${config.secondary_color}">${employee.nik} â€¢ ${employee.posisi}</p>
                                    </div>
                                </div>
                                <button onclick="handleBackToAttendance()" class="px-4 py-2 rounded-lg font-medium" style="background-color: ${config.surface_color}; color: ${config.secondary_color}; font-size: ${baseSize * 0.9}px">
                                    â† Kembali
                                </button>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <!-- Left Column: Attendance & Roster -->
                                <div class="lg:col-span-2 space-y-6">
                                    <!-- Today's Status -->
                                    <div class="rounded-2xl p-6 shadow-xl" style="background-color: ${config.surface_color}">
                                        <h2 class="font-bold mb-4 flex items-center gap-2" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">
                                            <span>ðŸ“…</span>
                                            <span>Status Hari Ini</span>
                                        </h2>
                                        
                                        ${todayRoster && (todayRoster.shift_roster === 'OFF' || todayRoster.shift_roster === 'CUTI' || todayRoster.shift_roster === 'IJIN') ? `
                                            <div class="text-center py-8">
                                                <div class="text-6xl mb-4">${todayRoster.shift_roster === 'OFF' ? 'ðŸ–ï¸' : 'ðŸ“‹'}</div>
                                                <h3 class="font-bold mb-2" style="font-size: ${baseSize * 1.2}px; color: ${config.text_color}">
                                                    ${todayRoster.shift_roster === 'OFF' ? 'Hari Libur' : todayRoster.shift_roster === 'CUTI' ? 'Sedang Cuti' : 'Sedang Ijin'}
                                                </h3>
                                                <p style="font-size: ${baseSize}px; color: ${config.secondary_color}">
                                                    ${todayRoster.keterangan}
                                                </p>
                                            </div>
                                        ` : `
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                                <div class="rounded-lg p-4" style="background-color: ${config.background_color}">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span class="text-2xl">â°</span>
                                                        <span class="font-medium" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Jadwal Shift</span>
                                                    </div>
                                                    <p class="font-bold" style="font-size: ${baseSize * 1.2}px; color: ${config.primary_color}">
                                                        ${todayRoster ? getShiftLabel(todayRoster.shift_roster) : getShiftLabel(employee.shift_tetap)}
                                                    </p>
                                                    <p style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">
                                                        ${todayRoster ? getShiftTime(todayRoster.shift_roster) : getShiftTime(employee.shift_tetap)}
                                                    </p>
                                                </div>
                                                <div class="rounded-lg p-4" style="background-color: ${config.background_color}">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span class="text-2xl">${hasCheckedIn ? (hasCheckedOut ? 'âœ…' : 'ðŸŸ¡') : 'â­•'}</span>
                                                        <span class="font-medium" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Status Absensi</span>
                                                    </div>
                                                    <p class="font-bold" style="font-size: ${baseSize * 1.2}px; color: ${hasCheckedIn ? (hasCheckedOut ? '#22c55e' : '#f59e0b') : config.secondary_color}">
                                                        ${hasCheckedIn ? (hasCheckedOut ? 'Selesai Kerja' : 'Sedang Kerja') : 'Belum Absen'}
                                                    </p>
                                                    ${lastAttendance ? `
                                                        <p style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">
                                                            ${lastAttendance.attendance_type === 'checkin' ? 'Masuk' : 'Keluar'}: ${formatTime(lastAttendance.waktu_absen)}
                                                        </p>
                                                    ` : ''}
                                                </div>
                                            </div>

                                            <!-- Attendance Button -->
                                            <div class="text-center">
                                                ${!hasCheckedIn ? `
                                                    <button onclick="startAttendanceProcess('checkin')" class="px-8 py-4 rounded-xl font-bold text-white text-lg" style="background-color: ${config.primary_color}; font-size: ${baseSize * 1.1}px">
                                                        ðŸ“¸ Absen Masuk
                                                    </button>
                                                ` : !hasCheckedOut ? `
                                                    <button onclick="startAttendanceProcess('checkout')" class="px-8 py-4 rounded-xl font-bold text-white text-lg" style="background-color: #f59e0b; font-size: ${baseSize * 1.1}px">
                                                        ðŸ“¸ Absen Pulang
                                                    </button>
                                                ` : `
                                                    <div class="rounded-lg p-4" style="background-color: #dcfce7">
                                                        <p class="font-semibold" style="color: #166534; font-size: ${baseSize}px">
                                                            âœ… Absensi hari ini sudah lengkap
                                                        </p>
                                                    </div>
                                                `}
                                            </div>
                                        `}
                                    </div>

                                    <!-- Weekly Roster -->
                                    <div class="rounded-2xl p-6 shadow-xl" style="background-color: ${config.surface_color}">
                                        <h2 class="font-bold mb-4 flex items-center gap-2" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">
                                            <span>ðŸ“‹</span>
                                            <span>Roster Minggu Ini</span>
                                        </h2>
                                        <div class="grid grid-cols-7 gap-2">
                                            ${weekRoster.map(day => `
                                                <div class="text-center p-3 rounded-lg ${day.isToday ? 'ring-2' : ''}" style="background-color: ${day.isToday ? config.background_color : '#f8fafc'}; ${day.isToday ? `border-color: ${config.primary_color}` : ''}">
                                                    <div class="font-semibold mb-1" style="font-size: ${baseSize * 0.8}px; color: ${config.text_color}">${day.day}</div>
                                                    <div class="font-bold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${day.isToday ? config.primary_color : config.text_color}">${day.dayNum}</div>
                                                    <div class="shift-badge shift-${day.shift === 'OFF' ? 'off' : day.shift}" style="font-size: ${baseSize * 0.7}px; padding: 2px 6px;">
                                                        ${day.shift === 'OFF' ? 'LIBUR' : day.shift === 'CUTI' ? 'CUTI' : day.shift === 'IJIN' ? 'IJIN' : day.shift === '-' ? '-' : getShiftLabel(day.shift)}
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>

                                    <!-- Work Hours Summary -->
                                    <div class="rounded-2xl p-6 shadow-xl" style="background-color: ${config.surface_color}">
                                        <h2 class="font-bold mb-4 flex items-center gap-2" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">
                                            <span>â±ï¸</span>
                                            <span>Jam Kerja Bulan Ini</span>
                                        </h2>
                                        <div class="grid grid-cols-3 gap-4">
                                            <div class="text-center p-4 rounded-lg" style="background-color: ${config.background_color}">
                                                <div class="font-bold mb-1" style="font-size: ${baseSize * 1.5}px; color: ${config.primary_color}">${monthlyHours.totalHours}h</div>
                                                <div style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">Total Jam</div>
                                            </div>
                                            <div class="text-center p-4 rounded-lg" style="background-color: ${config.background_color}">
                                                <div class="font-bold mb-1" style="font-size: ${baseSize * 1.5}px; color: ${config.primary_color}">${monthlyHours.totalDays}</div>
                                                <div style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">Hari Kerja</div>
                                            </div>
                                            <div class="text-center p-4 rounded-lg" style="background-color: ${config.background_color}">
                                                <div class="font-bold mb-1" style="font-size: ${baseSize * 1.5}px; color: ${config.primary_color}">${monthlyHours.averageHours}h</div>
                                                <div style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">Rata-rata</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Right Column: Leave & Overtime -->
                                <div class="space-y-6">
                                    <!-- Quick Actions -->
                                    <div class="rounded-2xl p-6 shadow-xl" style="background-color: ${config.surface_color}">
                                        <h2 class="font-bold mb-4" style="font-size: ${baseSize * 1.2}px; color: ${config.text_color}">Aksi Cepat</h2>
                                        <div class="space-y-3">
                                            <button onclick="openEmployeeLeaveModal('${employee.nik}')" class="w-full px-4 py-3 rounded-lg font-medium text-white flex items-center justify-center gap-2" style="background-color: ${config.secondary_color}; font-size: ${baseSize * 0.9}px">
                                                <span>ðŸ“</span>
                                                <span>Ajukan Cuti/Ijin</span>
                                            </button>
                                            <button onclick="openEmployeeOvertimeModal('${employee.nik}')" class="w-full px-4 py-3 rounded-lg font-medium text-white flex items-center justify-center gap-2" style="background-color: #f59e0b; font-size: ${baseSize * 0.9}px">
                                                <span>â°</span>
                                                <span>Lapor Lembur</span>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Recent Leave Requests -->
                                    <div class="rounded-2xl p-6 shadow-xl" style="background-color: ${config.surface_color}">
                                        <h2 class="font-bold mb-4" style="font-size: ${baseSize * 1.2}px; color: ${config.text_color}">Pengajuan Cuti/Ijin</h2>
                                        <div class="space-y-3 max-h-64 overflow-y-auto">
                                            ${employeeLeaves.length === 0 ? `
                                                <div class="text-center py-4">
                                                    <div class="text-3xl mb-2">ðŸ“</div>
                                                    <p style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Belum ada pengajuan</p>
                                                </div>
                                            ` : employeeLeaves.map(leave => `
                                                <div class="rounded-lg p-3 border" style="border-color: #e2e8f0; background-color: ${config.background_color}">
                                                    <div class="flex items-center justify-between mb-2">
                                                        <span class="font-medium capitalize" style="font-size: ${baseSize * 0.85}px; color: ${config.text_color}">${leave.leave_type}</span>
                                                        <span class="px-2 py-1 rounded text-xs font-semibold" style="background-color: ${leave.status === 'approved' ? '#dcfce7' : leave.status === 'rejected' ? '#fee2e2' : '#fef3c7'}; color: ${leave.status === 'approved' ? '#166534' : leave.status === 'rejected' ? '#991b1b' : '#92400e'}">
                                                            ${leave.status === 'approved' ? 'âœ“ Disetujui' : leave.status === 'rejected' ? 'âœ— Ditolak' : 'â³ Menunggu'}
                                                        </span>
                                                    </div>
                                                    <div style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">
                                                        ${formatDate(leave.tanggal)} â€¢ ${leave.alasan.substring(0, 50)}${leave.alasan.length > 50 ? '...' : ''}
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>

                                    <!-- Recent Overtime Reports -->
                                    <div class="rounded-2xl p-6 shadow-xl" style="background-color: ${config.surface_color}">
                                        <h2 class="font-bold mb-4" style="font-size: ${baseSize * 1.2}px; color: ${config.text_color}">Laporan Lembur</h2>
                                        <div class="space-y-3 max-h-64 overflow-y-auto">
                                            ${employeeOvertimes.length === 0 ? `
                                                <div class="text-center py-4">
                                                    <div class="text-3xl mb-2">â°</div>
                                                    <p style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Belum ada laporan</p>
                                                </div>
                                            ` : employeeOvertimes.map(overtime => `
                                                <div class="rounded-lg p-3 border" style="border-color: #e2e8f0; background-color: ${config.background_color}">
                                                    <div class="flex items-center justify-between mb-2">
                                                        <span class="font-medium" style="font-size: ${baseSize * 0.85}px; color: ${config.text_color}">${overtime.total_jam_lembur.toFixed(1)} jam</span>
                                                        <span class="px-2 py-1 rounded text-xs font-semibold" style="background-color: ${overtime.status === 'approved' ? '#dcfce7' : overtime.status === 'rejected' ? '#fee2e2' : '#fef3c7'}; color: ${overtime.status === 'approved' ? '#166534' : overtime.status === 'rejected' ? '#991b1b' : '#92400e'}">
                                                            ${overtime.status === 'approved' ? 'âœ“ Disetujui' : overtime.status === 'rejected' ? 'âœ— Ditolak' : 'â³ Menunggu'}
                                                        </span>
                                                    </div>
                                                    <div style="font-size: ${baseSize * 0.8}px; color: ${config.secondary_color}">
                                                        ${formatDate(overtime.tanggal)} â€¢ ${overtime.jam_mulai}-${overtime.jam_selesai}
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentView === 'camera') {
                app.innerHTML = `
                    <div class="min-h-full p-6">
                        <div class="max-w-2xl mx-auto">
                            <div class="flex items-center justify-between mb-8">
                                <div>
                                    <h1 class="font-bold mb-1" style="font-size: ${baseSize * 1.8}px; color: ${config.text_color}">Ambil Foto Wajah</h1>
                                    <p style="font-size: ${baseSize * 0.9}px; color: ${config.secondary_color}">Posisikan wajah di dalam lingkaran</p>
                                </div>
                                <button onclick="handleBackToAttendance()" class="px-4 py-2 rounded-lg font-medium" style="background-color: ${config.surface_color}; color: ${config.secondary_color}; font-size: ${baseSize * 0.9}px">
                                    â† Kembali
                                </button>
                            </div>
                            <div class="rounded-2xl p-8 shadow-xl fade-in" style="background-color: ${config.surface_color}">
                                <div class="camera-container mb-6">
                                    <video id="video" autoplay playsinline></video>
                                    <canvas id="canvas"></canvas>
                                    <div class="overlay-circle"></div>
                                </div>
                                <div class="space-y-4">
                                    <div class="rounded-lg p-4" style="background-color: #fef3c7">
                                        <p class="text-center font-medium" style="font-size: ${baseSize * 0.9}px; color: #92400e">
                                            âš ï¸ Pastikan wajah terlihat jelas dan pencahayaan cukup
                                        </p>
                                    </div>
                                    <button id="captureBtn" onclick="handleTakePhoto()" class="w-full btn-primary rounded-xl py-4 font-bold text-white flex items-center justify-center gap-3" style="background-color: ${config.primary_color}; font-size: ${baseSize * 1.1}px">
                                        <span class="text-2xl">ðŸ“¸</span>
                                        <span>Ambil Foto</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentView === 'success') {
                const lastAttendance = attendances[attendances.length - 1];
                const attendanceType = window.lastAttendanceType || 'checkin';
                app.innerHTML = `
                    <div class="min-h-full flex items-center justify-center p-6">
                        <div class="w-full max-w-md fade-in">
                            <div class="rounded-2xl p-8 shadow-xl text-center" style="background-color: ${config.surface_color}">
                                <div class="text-6xl mb-4">âœ…</div>
                                <h2 class="font-bold mb-2" style="font-size: ${baseSize * 1.8}px; color: ${config.text_color}">
                                    ${attendanceType === 'checkout' ? 'Absen Pulang Berhasil!' : 'Absen Masuk Berhasil!'}
                                </h2>
                                <p class="mb-6" style="font-size: ${baseSize}px; color: ${config.secondary_color}">Terima kasih, ${lastAttendance?.nama}</p>
                                <div class="rounded-xl p-6 mb-6" style="background-color: ${config.background_color}">
                                    <img src="${lastAttendance?.foto_data}" alt="Foto" class="w-32 h-32 rounded-full mx-auto mb-4 object-cover">
                                    <div class="space-y-2">
                                        <div class="flex justify-between">
                                            <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.9}px">Jenis:</span>
                                            <span class="font-semibold" style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px">
                                                ${attendanceType === 'checkout' ? 'Absen Pulang' : 'Absen Masuk'}
                                            </span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.9}px">Waktu:</span>
                                            <span class="font-semibold" style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px">${formatTime(lastAttendance?.waktu_absen)}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.9}px">Shift:</span>
                                            <span class="font-semibold" style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px">${getShiftLabel(lastAttendance?.shift_terdeteksi)}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.9}px">Status:</span>
                                            <span class="status-badge status-${lastAttendance?.status_absen}" style="font-size: ${baseSize * 0.85}px">
                                                ${lastAttendance?.status_absen === 'hadir' ? 'âœ“ Hadir' : lastAttendance?.status_absen === 'terlambat' ? 'â° Terlambat' : 'âš  Tidak Sesuai'}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <button onclick="handleBackToEmployeeDashboard()" class="w-full btn-primary rounded-xl py-4 font-bold text-white" style="background-color: ${config.primary_color}; font-size: ${baseSize * 1.1}px">
                                        Kembali ke Dashboard
                                    </button>
                                    <button onclick="handleBackToAttendance()" class="w-full btn-primary rounded-xl py-3 font-medium" style="background-color: ${config.surface_color}; color: ${config.secondary_color}; border: 2px solid #e2e8f0; font-size: ${baseSize}px">
                                        Portal Utama
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentView === 'dashboard') {
                const today = new Date().toISOString().split('T')[0];
                const todayAttendances = attendances.filter(att => {
                    const attDate = new Date(att.waktu_absen).toISOString().split('T')[0];
                    return attDate === today;
                });

                const hadirCount = todayAttendances.filter(att => att.status_absen === 'hadir').length;
                const terlambatCount = todayAttendances.filter(att => att.status_absen === 'terlambat').length;
                const tidakSesuaiCount = todayAttendances.filter(att => att.status_absen === 'tidak-sesuai').length;

                app.innerHTML = `
                    <div class="min-h-full p-6">
                        <div class="max-w-7xl mx-auto">
                            <div class="flex items-center justify-between mb-8">
                                <div>
                                    <h1 class="font-bold mb-1" style="font-size: ${baseSize * 2}px; color: ${config.text_color}">Dashboard Admin</h1>
                                    <p style="font-size: ${baseSize}px; color: ${config.secondary_color}">Kelola absensi dan karyawan</p>
                                </div>
                                <button onclick="handleLogout()" class="px-6 py-3 rounded-xl font-semibold text-white" style="background-color: ${config.secondary_color}; font-size: ${baseSize}px">
                                    Keluar
                                </button>
                            </div>

                            <div class="nav-tabs">
                                <div class="nav-tab ${currentTab === 'dashboard' ? 'active' : ''}" onclick="switchTab('dashboard')" style="font-size: ${baseSize}px; color: ${currentTab === 'dashboard' ? config.primary_color : config.secondary_color}">
                                    ðŸ“Š Dashboard
                                </div>
                                <div class="nav-tab ${currentTab === 'workhours' ? 'active' : ''}" onclick="switchTab('workhours')" style="font-size: ${baseSize}px; color: ${currentTab === 'workhours' ? config.primary_color : config.secondary_color}">
                                    â° Jam Kerja
                                </div>
                                <div class="nav-tab ${currentTab === 'roster' ? 'active' : ''}" onclick="switchTab('roster')" style="font-size: ${baseSize}px; color: ${currentTab === 'roster' ? config.primary_color : config.secondary_color}">
                                    ðŸ“… Roster Kerja
                                </div>
                                <div class="nav-tab ${currentTab === 'employees' ? 'active' : ''}" onclick="switchTab('employees')" style="font-size: ${baseSize}px; color: ${currentTab === 'employees' ? config.primary_color : config.secondary_color}">
                                    ðŸ‘¥ Karyawan
                                </div>
                                <div class="nav-tab ${currentTab === 'profiles' ? 'active' : ''}" onclick="switchTab('profiles')" style="font-size: ${baseSize}px; color: ${currentTab === 'profiles' ? config.primary_color : config.secondary_color}">
                                    ðŸ“‹ Profil Karyawan
                                </div>
                                <div class="nav-tab ${currentTab === 'leaves' ? 'active' : ''}" onclick="switchTab('leaves')" style="font-size: ${baseSize}px; color: ${currentTab === 'leaves' ? config.primary_color : config.secondary_color}">
                                    ðŸ“ Cuti & Lembur
                                </div>
                            </div>

                            ${currentTab === 'dashboard' ? `
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                    <div class="rounded-xl p-6 shadow-sm card-hover" style="background-color: ${config.surface_color}">
                                        <div class="flex items-center justify-between mb-2">
                                            <span style="font-size: ${baseSize * 0.9}px; color: ${config.secondary_color}">Hadir Hari Ini</span>
                                            <span class="text-2xl">âœ…</span>
                                        </div>
                                        <p class="font-bold" style="font-size: ${baseSize * 2}px; color: ${config.primary_color}">${hadirCount}</p>
                                    </div>
                                    <div class="rounded-xl p-6 shadow-sm card-hover" style="background-color: ${config.surface_color}">
                                        <div class="flex items-center justify-between mb-2">
                                            <span style="font-size: ${baseSize * 0.9}px; color: ${config.secondary_color}">Terlambat</span>
                                            <span class="text-2xl">â°</span>
                                        </div>
                                        <p class="font-bold" style="font-size: ${baseSize * 2}px; color: #f59e0b">${terlambatCount}</p>
                                    </div>
                                    <div class="rounded-xl p-6 shadow-sm card-hover" style="background-color: ${config.surface_color}">
                                        <div class="flex items-center justify-between mb-2">
                                            <span style="font-size: ${baseSize * 0.9}px; color: ${config.secondary_color}">Tidak Sesuai</span>
                                            <span class="text-2xl">âš ï¸</span>
                                        </div>
                                        <p class="font-bold" style="font-size: ${baseSize * 2}px; color: #ef4444">${tidakSesuaiCount}</p>
                                    </div>
                                    <div class="rounded-xl p-6 shadow-sm card-hover" style="background-color: ${config.surface_color}">
                                        <div class="flex items-center justify-between mb-2">
                                            <span style="font-size: ${baseSize * 0.9}px; color: ${config.secondary_color}">Total Karyawan</span>
                                            <span class="text-2xl">ðŸ‘¥</span>
                                        </div>
                                        <p class="font-bold" style="font-size: ${baseSize * 2}px; color: ${config.text_color}">${employees.filter(e => e.status === 'aktif').length}</p>
                                    </div>
                                </div>

                                <div class="rounded-xl p-6 shadow-sm" style="background-color: ${config.surface_color}">
                                    <div class="flex items-center justify-between mb-6">
                                        <h2 class="font-bold" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Riwayat Absensi</h2>
                                        <button onclick="exportToCSV()" class="px-4 py-2 rounded-lg font-medium flex items-center gap-2" style="background-color: ${config.primary_color}; color: white; font-size: ${baseSize * 0.9}px">
                                            <span>ðŸ“¥</span>
                                            <span>Ekspor CSV</span>
                                        </button>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                        <input type="date" id="dateFilter" onchange="filterAttendance()" class="px-4 py-2 rounded-lg border-2" style="font-size: ${baseSize * 0.9}px; border-color: #e2e8f0">
                                        <select id="shiftFilter" onchange="filterAttendance()" class="px-4 py-2 rounded-lg border-2" style="font-size: ${baseSize * 0.9}px; border-color: #e2e8f0">
                                            <option value="">Semua Shift</option>
                                            <option value="1">${config.shift1_label}</option>
                                            <option value="2">${config.shift2_label}</option>
                                            <option value="3">${config.shift3_label}</option>
                                        </select>
                                        <input type="text" id="nikFilter" placeholder="Cari NIK/Nama" onkeyup="filterAttendance()" class="px-4 py-2 rounded-lg border-2" style="font-size: ${baseSize * 0.9}px; border-color: #e2e8f0">
                                    </div>
                                    <div id="attendanceList" class="space-y-4 max-h-96 overflow-y-auto"></div>
                                </div>
                            ` : currentTab === 'workhours' ? `
                                <div class="space-y-6">
                                    <div class="rounded-xl p-6 shadow-sm" style="background-color: ${config.surface_color}">
                                        <div class="flex items-center justify-between mb-6">
                                            <h2 class="font-bold" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Laporan Jam Kerja Bulanan</h2>
                                            <div class="flex gap-3">
                                                <select id="monthFilter" onchange="renderWorkHoursReport()" class="px-4 py-2 rounded-lg border-2" style="font-size: ${baseSize * 0.9}px; border-color: #e2e8f0">
                                                    <option value="0">Januari</option>
                                                    <option value="1">Februari</option>
                                                    <option value="2">Maret</option>
                                                    <option value="3">April</option>
                                                    <option value="4">Mei</option>
                                                    <option value="5">Juni</option>
                                                    <option value="6">Juli</option>
                                                    <option value="7">Agustus</option>
                                                    <option value="8">September</option>
                                                    <option value="9">Oktober</option>
                                                    <option value="10">November</option>
                                                    <option value="11">Desember</option>
                                                </select>
                                                <select id="yearFilter" onchange="renderWorkHoursReport()" class="px-4 py-2 rounded-lg border-2" style="font-size: ${baseSize * 0.9}px; border-color: #e2e8f0">
                                                    <option value="2024">2024</option>
                                                    <option value="2023">2023</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div id="workHoursReport"></div>
                                    </div>

                                    <div class="rounded-xl p-6 shadow-sm" style="background-color: ${config.surface_color}">
                                        <h3 class="font-bold mb-4" style="font-size: ${baseSize * 1.2}px; color: ${config.text_color}">Detail Jam Kerja Harian</h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                            <select id="employeeFilter" onchange="renderDailyWorkHours()" class="px-4 py-2 rounded-lg border-2" style="font-size: ${baseSize * 0.9}px; border-color: #e2e8f0">
                                                <option value="">Pilih Karyawan</option>
                                                ${REFERENCE_EMPLOYEES.map(emp => `<option value="${emp.nik}">${emp.nama} (${emp.nik})</option>`).join('')}
                                            </select>
                                            <input type="month" id="monthYearFilter" onchange="renderDailyWorkHours()" class="px-4 py-2 rounded-lg border-2" style="font-size: ${baseSize * 0.9}px; border-color: #e2e8f0">
                                        </div>
                                        <div id="dailyWorkHours" class="max-h-96 overflow-y-auto"></div>
                                    </div>
                                </div>
                            ` : currentTab === 'roster' ? `
                                <div class="rounded-xl p-6 shadow-sm" style="background-color: ${config.surface_color}">
                                    <div class="flex items-center justify-between mb-6">
                                        <h2 class="font-bold" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Roster Kerja Mingguan</h2>
                                        <div class="flex gap-3">
                                            ${rosters.length > 0 ? `
                                                <button id="delete-btn-clearRoster" onclick="showDeleteConfirm('clearRoster')" class="px-4 py-2 rounded-lg font-medium" style="background-color: #fee2e2; color: #991b1b; font-size: ${baseSize * 0.9}px">
                                                    ðŸ—‘ï¸ Hapus Roster
                                                </button>
                                                <div id="confirm-delete-div-clearRoster" style="display: none;" class="flex gap-2">
                                                    <button id="clearRosterConfirm" onclick="clearRoster()" class="px-3 py-2 rounded-lg font-medium" style="background-color: #ef4444; color: white; font-size: ${baseSize * 0.85}px">
                                                        Ya, Hapus Semua
                                                    </button>
                                                    <button onclick="hideDeleteConfirm('clearRoster')" class="px-3 py-2 rounded-lg font-medium" style="background-color: #e2e8f0; color: #64748b; font-size: ${baseSize * 0.85}px">
                                                        Batal
                                                    </button>
                                                </div>
                                            ` : ''}
                                            <button id="generateRosterBtn" onclick="generateAndSaveRoster()" class="px-4 py-2 rounded-lg font-medium text-white" style="background-color: ${config.primary_color}; font-size: ${baseSize * 0.9}px">
                                                ðŸ“… Generate Roster
                                            </button>
                                        </div>
                                    </div>
                                    <div id="rosterCalendar"></div>
                                </div>
                            ` : currentTab === 'profiles' ? `
                                <div class="rounded-xl p-6 shadow-sm" style="background-color: ${config.surface_color}">
                                    <div class="flex items-center justify-between mb-6">
                                        <h2 class="font-bold" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Profil Karyawan Lengkap</h2>
                                        <div class="flex gap-3">
                                            <select id="profileFilter" onchange="filterProfiles()" class="px-4 py-2 rounded-lg border-2" style="font-size: ${baseSize * 0.9}px; border-color: #e2e8f0">
                                                <option value="">Semua Posisi</option>
                                                <option value="Koordinator">Koordinator</option>
                                                <option value="Supervisor">Supervisor</option>
                                                <option value="Kasir">Kasir</option>
                                                <option value="Barista">Barista</option>
                                                <option value="Waitress">Waitress</option>
                                                <option value="Koki">Koki</option>
                                            </select>
                                            <input type="text" id="profileSearch" placeholder="Cari nama/NIK" onkeyup="filterProfiles()" class="px-4 py-2 rounded-lg border-2" style="font-size: ${baseSize * 0.9}px; border-color: #e2e8f0">
                                        </div>
                                    </div>
                                    <div id="profilesList" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"></div>
                                </div>
                            ` : currentTab === 'leaves' ? `
                                <div class="space-y-6">
                                    <!-- Pengajuan Cuti/Ijin -->
                                    <div class="rounded-xl p-6 shadow-sm" style="background-color: ${config.surface_color}">
                                        <div class="flex items-center justify-between mb-6">
                                            <h2 class="font-bold" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Pengajuan Cuti & Ijin</h2>
                                            <div class="flex gap-3">
                                                <select id="leaveStatusFilter" onchange="renderLeaveRequests()" class="px-4 py-2 rounded-lg border-2" style="font-size: ${baseSize * 0.9}px; border-color: #e2e8f0">
                                                    <option value="">Semua Status</option>
                                                    <option value="pending">Menunggu</option>
                                                    <option value="approved">Disetujui</option>
                                                    <option value="rejected">Ditolak</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div id="leaveRequestsList" class="space-y-4 max-h-96 overflow-y-auto"></div>
                                    </div>

                                    <!-- Laporan Lembur -->
                                    <div class="rounded-xl p-6 shadow-sm" style="background-color: ${config.surface_color}">
                                        <div class="flex items-center justify-between mb-6">
                                            <h2 class="font-bold" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Laporan Lembur</h2>
                                            <div class="flex gap-3">
                                                <select id="overtimeStatusFilter" onchange="renderOvertimeReports()" class="px-4 py-2 rounded-lg border-2" style="font-size: ${baseSize * 0.9}px; border-color: #e2e8f0">
                                                    <option value="">Semua Status</option>
                                                    <option value="pending">Menunggu</option>
                                                    <option value="approved">Disetujui</option>
                                                    <option value="rejected">Ditolak</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div id="overtimeReportsList" class="space-y-4 max-h-96 overflow-y-auto"></div>
                                    </div>
                                </div>
                            ` : `
                                <div class="rounded-xl p-6 shadow-sm" style="background-color: ${config.surface_color}">
                                    <div class="flex items-center justify-between mb-6">
                                        <h2 class="font-bold" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Kelola Karyawan</h2>
                                        <button onclick="openModal('addEmployeeModal')" class="px-4 py-2 rounded-lg font-medium text-white" style="background-color: ${config.primary_color}; font-size: ${baseSize * 0.9}px">
                                            + Tambah Karyawan
                                        </button>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        ${employees.map(emp => `
                                            <div class="rounded-lg p-4 border-2 card-hover" style="border-color: #e2e8f0; background-color: ${config.surface_color}">
                                                <div class="flex items-start justify-between mb-3">
                                                    <div>
                                                        <p class="font-semibold" style="font-size: ${baseSize}px; color: ${config.text_color}">${emp.nama}</p>
                                                        <p style="font-size: ${baseSize * 0.85}px; color: ${config.secondary_color}">${emp.nik}</p>
                                                    </div>
                                                    <span class="px-2 py-1 rounded text-xs font-semibold" style="background-color: ${emp.status === 'aktif' ? '#dcfce7' : '#fee2e2'}; color: ${emp.status === 'aktif' ? '#166534' : '#991b1b'}">
                                                        ${emp.status === 'aktif' ? 'âœ“ Aktif' : 'âœ— Non-aktif'}
                                                    </span>
                                                </div>
                                                <div class="flex items-center justify-between">
                                                    <div>
                                                        <p style="font-size: ${baseSize * 0.85}px; color: ${config.secondary_color}">${emp.posisi}</p>
                                                        <span class="shift-badge shift-${emp.shift_tetap}" style="font-size: ${baseSize * 0.75}px">${getShiftLabel(emp.shift_tetap)}</span>
                                                    </div>
                                                    <div class="flex gap-2">
                                                        <button onclick="openEditEmployeeModal(allRecords.find(r => r.__backendId === '${emp.__backendId}'))" class="px-3 py-1 rounded text-xs font-medium" style="background-color: #dbeafe; color: #1e40af; font-size: ${baseSize * 0.8}px">
                                                            Edit
                                                        </button>
                                                        <button id="delete-btn-${emp.__backendId}" onclick="showDeleteConfirm('${emp.__backendId}')" class="px-3 py-1 rounded text-xs font-medium" style="background-color: #fee2e2; color: #991b1b; font-size: ${baseSize * 0.8}px">
                                                            Hapus
                                                        </button>
                                                        <div id="confirm-delete-div-${emp.__backendId}" style="display: none;" class="flex gap-2 mt-2">
                                                            <button id="confirm-delete-${emp.__backendId}" onclick="handleDeleteEmployee(allRecords.find(r => r.__backendId === '${emp.__backendId}'))" class="px-2 py-1 rounded text-xs font-medium" style="background-color: #ef4444; color: white; font-size: ${baseSize * 0.75}px">
                                                                Ya, Hapus
                                                            </button>
                                                            <button onclick="hideDeleteConfirm('${emp.__backendId}')" class="px-2 py-1 rounded text-xs font-medium" style="background-color: #e2e8f0; color: #64748b; font-size: ${baseSize * 0.75}px">
                                                                Batal
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `}
                        </div>
                    </div>

                    <div id="addEmployeeModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-6 modal-backdrop">
                        <div class="rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl fade-in" style="background-color: ${config.surface_color}">
                            <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.5}px; color: ${config.text_color}">Tambah Profil Karyawan Baru</h2>
                            <form id="employeeForm" class="space-y-4" onsubmit="event.preventDefault(); handleAddEmployee();">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">NIK *</label>
                                        <input type="text" name="nik" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Contoh: EMP013">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Nama Lengkap *</label>
                                        <input type="text" name="nama" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Nama lengkap karyawan">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Posisi *</label>
                                        <select name="posisi" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                            <option value="">Pilih Posisi</option>
                                            <option value="Koordinator">Koordinator</option>
                                            <option value="Supervisor">Supervisor</option>
                                            <option value="Kasir">Kasir</option>
                                            <option value="Barista">Barista</option>
                                            <option value="Waitress">Waitress</option>
                                            <option value="Koki">Koki</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Shift Tetap *</label>
                                        <select name="shift_tetap" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                            <option value="1">${config.shift1_label}</option>
                                            <option value="2">${config.shift2_label}</option>
                                            <option value="3">${config.shift3_label}</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Email</label>
                                        <input type="email" name="email" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="email@company.com">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Telepon</label>
                                        <input type="tel" name="telepon" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="081234567890">
                                    </div>
                                </div>

                                <div>
                                    <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Alamat</label>
                                    <textarea name="alamat" rows="2" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Alamat lengkap"></textarea>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Tanggal Lahir</label>
                                        <input type="date" name="tanggal_lahir" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Tanggal Bergabung</label>
                                        <input type="date" name="tanggal_bergabung" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Pendidikan</label>
                                        <input type="text" name="pendidikan" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Contoh: S1 Teknik Industri">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Status Pernikahan</label>
                                        <select name="status_pernikahan" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                            <option value="Belum Menikah">Belum Menikah</option>
                                            <option value="Menikah">Menikah</option>
                                        </select>
                                    </div>
                                </div>

                                <div>
                                    <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Kontak Darurat</label>
                                    <input type="text" name="kontak_darurat" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Nama (Hubungan) - Nomor Telepon">
                                </div>

                                <div>
                                    <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">URL Foto Profil</label>
                                    <input type="url" name="foto_profil" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="https://... (opsional, akan dibuat otomatis jika kosong)">
                                </div>

                                <div class="flex gap-3 pt-4">
                                    <button type="button" onclick="closeModal('addEmployeeModal')" class="flex-1 px-4 py-3 rounded-lg font-semibold" style="background-color: #e2e8f0; color: ${config.secondary_color}; font-size: ${baseSize}px">
                                        Batal
                                    </button>
                                    <button type="submit" class="flex-1 px-4 py-3 rounded-lg font-semibold text-white" style="background-color: ${config.primary_color}; font-size: ${baseSize}px">
                                        Simpan Profil
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div id="editEmployeeModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-6 modal-backdrop">
                        <div class="rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl fade-in" style="background-color: ${config.surface_color}">
                            <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.5}px; color: ${config.text_color}">Edit Profil Karyawan</h2>
                            <form id="editEmployeeForm" class="space-y-4" onsubmit="event.preventDefault(); handleEditEmployee();">
                                <input type="hidden" name="employee_id">
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">NIK *</label>
                                        <input type="text" name="nik" required readonly class="w-full px-4 py-3 rounded-lg border-2 bg-gray-100" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Nama Lengkap *</label>
                                        <input type="text" name="nama" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Posisi *</label>
                                        <select name="posisi" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                            <option value="Koordinator">Koordinator</option>
                                            <option value="Supervisor">Supervisor</option>
                                            <option value="Kasir">Kasir</option>
                                            <option value="Barista">Barista</option>
                                            <option value="Waitress">Waitress</option>
                                            <option value="Koki">Koki</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Shift Tetap *</label>
                                        <select name="shift_tetap" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                            <option value="1">${config.shift1_label}</option>
                                            <option value="2">${config.shift2_label}</option>
                                            <option value="3">${config.shift3_label}</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Email</label>
                                        <input type="email" name="email" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Telepon</label>
                                        <input type="tel" name="telepon" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                </div>

                                <div>
                                    <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Alamat</label>
                                    <textarea name="alamat" rows="2" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0"></textarea>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Tanggal Lahir</label>
                                        <input type="date" name="tanggal_lahir" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Tanggal Bergabung</label>
                                        <input type="date" name="tanggal_bergabung" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Pendidikan</label>
                                        <input type="text" name="pendidikan" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Status Pernikahan</label>
                                        <select name="status_pernikahan" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                            <option value="Belum Menikah">Belum Menikah</option>
                                            <option value="Menikah">Menikah</option>
                                        </select>
                                    </div>
                                </div>

                                <div>
                                    <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Kontak Darurat</label>
                                    <input type="text" name="kontak_darurat" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                </div>

                                <div>
                                    <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">URL Foto Profil</label>
                                    <input type="url" name="foto_profil" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                </div>

                                <div class="flex gap-3 pt-4">
                                    <button type="button" onclick="closeModal('editEmployeeModal')" class="flex-1 px-4 py-3 rounded-lg font-semibold" style="background-color: #e2e8f0; color: ${config.secondary_color}; font-size: ${baseSize}px">
                                        Batal
                                    </button>
                                    <button type="submit" class="flex-1 px-4 py-3 rounded-lg font-semibold text-white" style="background-color: ${config.primary_color}; font-size: ${baseSize}px">
                                        Simpan Perubahan
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div id="editRosterModal" class="hidden">
                    </div>

                    <!-- Leave Request Modal -->
                    <div id="leaveRequestModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-6 modal-backdrop">
                        <div class="rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl fade-in" style="background-color: ${config.surface_color}">
                            <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Pengajuan Cuti/Ijin</h2>
                            <form id="leaveRequestForm" class="space-y-6" onsubmit="event.preventDefault(); handleLeaveRequest();">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">NIK *</label>
                                        <input type="text" name="nik" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Contoh: EMP001">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Jenis Permohonan *</label>
                                        <select name="leave_type" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                            <option value="">Pilih Jenis</option>
                                            <option value="cuti">Cuti Tahunan</option>
                                            <option value="ijin">Ijin Khusus</option>
                                            <option value="sakit">Sakit</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Calendar Section -->
                                <div>
                                    <label class="block font-semibold mb-3" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Pilih Tanggal Cuti/Ijin *</label>
                                    <div class="rounded-lg p-4 border-2" style="border-color: #e2e8f0; background-color: ${config.background_color}">
                                        <div class="flex items-center justify-between mb-4">
                                            <button type="button" id="prevMonthLeave" class="px-3 py-2 rounded-lg font-semibold" style="background-color: ${config.surface_color}; color: ${config.text_color}; font-size: ${baseSize * 0.9}px">â€¹</button>
                                            <h3 id="currentMonthLeave" class="font-bold" style="font-size: ${baseSize * 1.1}px; color: ${config.text_color}"></h3>
                                            <button type="button" id="nextMonthLeave" class="px-3 py-2 rounded-lg font-semibold" style="background-color: ${config.surface_color}; color: ${config.text_color}; font-size: ${baseSize * 0.9}px">â€º</button>
                                        </div>
                                        <div class="calendar-header">
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Min</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Sen</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Sel</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Rab</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Kam</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Jum</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Sab</div>
                                        </div>
                                        <div id="leaveCalendarGrid" class="calendar-grid"></div>
                                    </div>
                                    <input type="hidden" name="tanggal" id="selectedLeaveDate" required>
                                    <div id="selectedLeaveDateDisplay" class="mt-2 text-center font-medium" style="color: ${config.primary_color}; font-size: ${baseSize * 0.9}px"></div>
                                </div>

                                <div>
                                    <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Alasan *</label>
                                    <textarea name="alasan" required rows="3" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Jelaskan alasan cuti/ijin"></textarea>
                                </div>

                                <div class="flex gap-3 pt-4">
                                    <button type="button" onclick="closeModal('leaveRequestModal')" class="flex-1 px-4 py-3 rounded-lg font-semibold" style="background-color: #e2e8f0; color: ${config.secondary_color}; font-size: ${baseSize}px">
                                        Batal
                                    </button>
                                    <button type="submit" class="flex-1 px-4 py-3 rounded-lg font-semibold text-white" style="background-color: ${config.primary_color}; font-size: ${baseSize}px">
                                        Ajukan Cuti/Ijin
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Overtime Modal -->
                    <div id="overtimeModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-6 modal-backdrop">
                        <div class="rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl fade-in" style="background-color: ${config.surface_color}">
                            <h2 class="font-bold mb-6" style="font-size: ${baseSize * 1.3}px; color: ${config.text_color}">Laporan Lembur</h2>
                            <form id="overtimeForm" class="space-y-6" onsubmit="event.preventDefault(); handleOvertimeReport();">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">NIK *</label>
                                        <input type="text" name="nik" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Contoh: EMP001">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Shift Lembur *</label>
                                        <select name="shift_lembur" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                            <option value="">Pilih Shift</option>
                                            <option value="1">${config.shift1_label || 'Shift Pagi'} (08:00-16:00)</option>
                                            <option value="2">${config.shift2_label || 'Shift Sore'} (16:00-24:00)</option>
                                            <option value="3">${config.shift3_label || 'Shift Malam'} (00:00-08:00)</option>
                                            <option value="weekend">Lembur Weekend</option>
                                            <option value="holiday">Lembur Hari Libur</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Calendar Section -->
                                <div>
                                    <label class="block font-semibold mb-3" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Pilih Tanggal Lembur *</label>
                                    <div class="rounded-lg p-4 border-2" style="border-color: #e2e8f0; background-color: ${config.background_color}">
                                        <div class="flex items-center justify-between mb-4">
                                            <button type="button" id="prevMonthOvertime" class="px-3 py-2 rounded-lg font-semibold" style="background-color: ${config.surface_color}; color: ${config.text_color}; font-size: ${baseSize * 0.9}px">â€¹</button>
                                            <h3 id="currentMonthOvertime" class="font-bold" style="font-size: ${baseSize * 1.1}px; color: ${config.text_color}"></h3>
                                            <button type="button" id="nextMonthOvertime" class="px-3 py-2 rounded-lg font-semibold" style="background-color: ${config.surface_color}; color: ${config.text_color}; font-size: ${baseSize * 0.9}px">â€º</button>
                                        </div>
                                        <div class="calendar-header">
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Min</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Sen</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Sel</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Rab</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Kam</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Jum</div>
                                            <div class="calendar-header-day" style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Sab</div>
                                        </div>
                                        <div id="overtimeCalendarGrid" class="calendar-grid"></div>
                                    </div>
                                    <input type="hidden" name="tanggal" id="selectedOvertimeDate" required>
                                    <div id="selectedOvertimeDateDisplay" class="mt-2 text-center font-medium" style="color: #f59e0b; font-size: ${baseSize * 0.9}px"></div>
                                </div>

                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Jam Mulai Lembur *</label>
                                        <input type="time" name="jam_mulai" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                    <div>
                                        <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Jam Selesai Lembur *</label>
                                        <input type="time" name="jam_selesai" required class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0">
                                    </div>
                                </div>

                                <div id="overtimeHoursCalculation" class="rounded-lg p-4" style="background-color: ${config.background_color}; display: none;">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-2xl">â±ï¸</span>
                                        <span class="font-semibold" style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px">Kalkulasi Jam Lembur</span>
                                    </div>
                                    <div class="grid grid-cols-3 gap-4 text-center">
                                        <div>
                                            <p class="font-bold" style="color: #f59e0b; font-size: ${baseSize * 1.2}px" id="totalOvertimeHours">0.0</p>
                                            <p style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Total Jam</p>
                                        </div>
                                        <div>
                                            <p class="font-bold" style="color: ${config.primary_color}; font-size: ${baseSize * 1.2}px" id="overtimeRate">1.5x</p>
                                            <p style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Rate</p>
                                        </div>
                                        <div>
                                            <p class="font-bold" style="color: #22c55e; font-size: ${baseSize * 1.2}px" id="overtimePoints">0</p>
                                            <p style="color: ${config.secondary_color}; font-size: ${baseSize * 0.8}px">Poin</p>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label class="block font-semibold mb-2" style="font-size: ${baseSize * 0.9}px; color: ${config.text_color}">Pekerjaan yang Dilakukan *</label>
                                    <textarea name="pekerjaan" required rows="3" class="w-full px-4 py-3 rounded-lg border-2" style="font-size: ${baseSize}px; border-color: #e2e8f0" placeholder="Jelaskan detail pekerjaan lembur yang dilakukan"></textarea>
                                </div>

                                <div class="flex gap-3 pt-4">
                                    <button type="button" onclick="closeModal('overtimeModal')" class="flex-1 px-4 py-3 rounded-lg font-semibold" style="background-color: #e2e8f0; color: ${config.secondary_color}; font-size: ${baseSize}px">
                                        Batal
                                    </button>
                                    <button type="submit" class="flex-1 px-4 py-3 rounded-lg font-semibold text-white" style="background-color: #f59e0b; font-size: ${baseSize}px">
                                        Laporkan Lembur
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;

                if (currentTab === 'dashboard') {
                    renderAttendanceList(attendances);
                } else if (currentTab === 'workhours') {
                    renderWorkHoursReport();
                    renderDailyWorkHours();
                    // Set current month/year as default
                    const now = new Date();
                    const monthFilter = document.getElementById('monthFilter');
                    const yearFilter = document.getElementById('yearFilter');
                    const monthYearFilter = document.getElementById('monthYearFilter');
                    if (monthFilter) monthFilter.value = now.getMonth().toString();
                    if (yearFilter) yearFilter.value = now.getFullYear().toString();
                    if (monthYearFilter) monthYearFilter.value = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
                } else if (currentTab === 'roster') {
                    renderRosterCalendar();
                } else if (currentTab === 'profiles') {
                    renderProfilesList(REFERENCE_EMPLOYEES);
                } else if (currentTab === 'leaves') {
                    renderLeaveRequests();
                    renderOvertimeReports();
                }
            }
        }

        let leaveRequests = [];
        let overtimeReports = [];

        function renderLeaveRequests() {
            const container = document.getElementById('leaveRequestsList');
            if (!container) return;

            const config = window.elementSdk?.config || defaultConfig;
            const baseSize = config.font_size || defaultConfig.font_size;

            const statusFilter = document.getElementById('leaveStatusFilter')?.value;
            let filtered = [...leaveRequests];

            if (statusFilter) {
                filtered = filtered.filter(req => req.status === statusFilter);
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-4xl mb-3">ðŸ“</div>
                        <p style="color: ${config.secondary_color}; font-size: ${baseSize}px">
                            Belum ada pengajuan cuti/ijin
                        </p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(req => `
                <div class="rounded-lg p-4 border-2" style="border-color: #e2e8f0; background-color: ${config.surface_color}">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h4 class="font-semibold" style="font-size: ${baseSize}px; color: ${config.text_color}">${req.nama}</h4>
                                <span class="px-2 py-1 rounded text-xs font-medium" style="background-color: ${config.background_color}; color: ${config.secondary_color}">${req.nik}</span>
                                <span class="px-2 py-1 rounded text-xs font-medium capitalize" style="background-color: ${req.leave_type === 'cuti' ? '#dbeafe' : req.leave_type === 'ijin' ? '#fef3c7' : '#fee2e2'}; color: ${req.leave_type === 'cuti' ? '#1e40af' : req.leave_type === 'ijin' ? '#92400e' : '#991b1b'}">${req.leave_type}</span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-sm mb-3">
                                <div>
                                    <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Tanggal:</span>
                                    <p class="font-medium" style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px">${formatDate(req.tanggal)}</p>
                                </div>
                                <div>
                                    <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Diajukan:</span>
                                    <p class="font-medium" style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px">${formatDate(req.tanggal_pengajuan)}</p>
                                </div>
                            </div>
                            <div class="mb-3">
                                <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Alasan:</span>
                                <p style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px">${req.alasan}</p>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2">
                            <span class="px-3 py-1 rounded-full text-xs font-semibold" style="background-color: ${req.status === 'approved' ? '#dcfce7' : req.status === 'rejected' ? '#fee2e2' : '#fef3c7'}; color: ${req.status === 'approved' ? '#166534' : req.status === 'rejected' ? '#991b1b' : '#92400e'}">
                                ${req.status === 'approved' ? 'âœ“ Disetujui' : req.status === 'rejected' ? 'âœ— Ditolak' : 'â³ Menunggu'}
                            </span>
                            ${req.status === 'pending' ? `
                                <div class="flex gap-1">
                                    <button onclick="approveLeaveRequest('${req.__backendId}')" class="px-2 py-1 rounded text-xs font-medium text-white" style="background-color: #22c55e; font-size: ${baseSize * 0.75}px">
                                        Setuju
                                    </button>
                                    <button onclick="rejectLeaveRequest('${req.__backendId}')" class="px-2 py-1 rounded text-xs font-medium text-white" style="background-color: #ef4444; font-size: ${baseSize * 0.75}px">
                                        Tolak
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderOvertimeReports() {
            const container = document.getElementById('overtimeReportsList');
            if (!container) return;

            const config = window.elementSdk?.config || defaultConfig;
            const baseSize = config.font_size || defaultConfig.font_size;

            const statusFilter = document.getElementById('overtimeStatusFilter')?.value;
            let filtered = [...overtimeReports];

            if (statusFilter) {
                filtered = filtered.filter(rep => rep.status === statusFilter);
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-4xl mb-3">â°</div>
                        <p style="color: ${config.secondary_color}; font-size: ${baseSize}px">
                            Belum ada laporan lembur
                        </p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(rep => `
                <div class="rounded-lg p-4 border-2" style="border-color: #e2e8f0; background-color: ${config.surface_color}">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h4 class="font-semibold" style="font-size: ${baseSize}px; color: ${config.text_color}">${rep.nama}</h4>
                                <span class="px-2 py-1 rounded text-xs font-medium" style="background-color: ${config.background_color}; color: ${config.secondary_color}">${rep.nik}</span>
                                <span class="px-2 py-1 rounded text-xs font-medium" style="background-color: #f59e0b; color: white">${rep.total_jam_lembur.toFixed(1)} jam</span>
                            </div>
                            <div class="grid grid-cols-3 gap-4 text-sm mb-3">
                                <div>
                                    <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Tanggal:</span>
                                    <p class="font-medium" style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px">${formatDate(rep.tanggal)}</p>
                                </div>
                                <div>
                                    <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Waktu:</span>
                                    <p class="font-medium" style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px">${rep.jam_mulai} - ${rep.jam_selesai}</p>
                                </div>
                                <div>
                                    <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Dilaporkan:</span>
                                    <p class="font-medium" style="color: ${config.text_color}; font-size: ${baseSize * 0.85}px">${formatDate(rep.tanggal_laporan)}</p>
                                </div>
                            </div>
                            <div class="mb-3">
                                <span style="color: ${config.secondary_color}; font-size: ${baseSize * 0.85}px">Pekerjaan:</span>
                                <p style="color: ${config.text_color}; font-size: ${baseSize * 0.9}px">${rep.pekerjaan}</p>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2">
                            <span class="px-3 py-1 rounded-full text-xs font-semibold" style="background-color: ${rep.status === 'approved' ? '#dcfce7' : rep.status === 'rejected' ? '#fee2e2' : '#fef3c7'}; color: ${rep.status === 'approved' ? '#166534' : rep.status === 'rejected' ? '#991b1b' : '#92400e'}">
                                ${rep.status === 'approved' ? 'âœ“ Disetujui' : rep.status === 'rejected' ? 'âœ— Ditolak' : 'â³ Menunggu'}
                            </span>
                            ${rep.status === 'pending' ? `
                                <div class="flex gap-1">
                                    <button onclick="approveOvertimeReport('${rep.__backendId}')" class="px-2 py-1 rounded text-xs font-medium text-white" style="background-color: #22c55e; font-size: ${baseSize * 0.75}px">
                                        Setuju
                                    </button>
                                    <button onclick="rejectOvertimeReport('${rep.__backendId}')" class="px-2 py-1 rounded text-xs font-medium text-white" style="background-color: #ef4444; font-size: ${baseSize * 0.75}px">
                                        Tolak
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function approveLeaveRequest(recordId) {
            const record = allRecords.find(r => r.__backendId === recordId);
            if (!record) return;

            const updatedRecord = { ...record, status: 'approved' };
            const result = await window.dataSdk.update(updatedRecord);

            if (result.isOk) {
                showToast('Pengajuan cuti/ijin disetujui', 'success');
            } else {
                showToast('Gagal menyetujui pengajuan', 'error');
            }
        }

        async function rejectLeaveRequest(recordId) {
            const record = allRecords.find(r => r.__backendId === recordId);
            if (!record) return;

            const updatedRecord = { ...record, status: 'rejected' };
            const result = await window.dataSdk.update(updatedRecord);

            if (result.isOk) {
                showToast('Pengajuan cuti/ijin ditolak', 'success');
            } else {
                showToast('Gagal menolak pengajuan', 'error');
            }
        }

        async function approveOvertimeReport(recordId) {
            const record = allRecords.find(r => r.__backendId === recordId);
            if (!record) return;

            const updatedRecord = { ...record, status: 'approved' };
            const result = await window.dataSdk.update(updatedRecord);

            if (result.isOk) {
                showToast('Laporan lembur disetujui', 'success');
            } else {
                showToast('Gagal menyetujui laporan', 'error');
            }
        }

        async function rejectOvertimeReport(recordId) {
            const record = allRecords.find(r => r.__backendId === recordId);
            if (!record) return;

            const updatedRecord = { ...record, status: 'rejected' };
            const result = await window.dataSdk.update(updatedRecord);

            if (result.isOk) {
                showToast('Laporan lembur ditolak', 'success');
            } else {
                showToast('Gagal menolak laporan', 'error');
            }
        }

        const dataHandler = {
            onDataChanged(data) {
                allRecords = data;
                employees = data.filter(record => record.type === 'employee');
                attendances = data.filter(record => record.type === 'attendance')
                    .sort((a, b) => new Date(b.waktu_absen) - new Date(a.waktu_absen));
                rosters = data.filter(record => record.type === 'roster')
                    .sort((a, b) => new Date(a.tanggal) - new Date(b.tanggal));
                workHours = data.filter(record => record.type === 'work_hours')
                    .sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
                leaveRequests = data.filter(record => record.type === 'leave_request')
                    .sort((a, b) => new Date(b.tanggal_pengajuan) - new Date(a.tanggal_pengajuan));
                overtimeReports = data.filter(record => record.type === 'overtime_report')
                    .sort((a, b) => new Date(b.tanggal_laporan) - new Date(a.tanggal_laporan));
                
                render();
            }
        };

        async function onConfigChange(config) {
            await render();
        }

        async function init() {
            if (window.dataSdk) {
                const initResult = await window.dataSdk.init(dataHandler);
                if (!initResult.isOk) {
                    console.error("Failed to initialize data SDK");
                }
            }

            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities: (config) => ({
                        recolorables: [
                            {
                                get: () => config.background_color || defaultConfig.background_color,
                                set: (value) => {
                                    config.background_color = value;
                                    window.elementSdk.setConfig({ background_color: value });
                                }
                            },
                            {
                                get: () => config.surface_color || defaultConfig.surface_color,
                                set: (value) => {
                                    config.surface_color = value;
                                    window.elementSdk.setConfig({ surface_color: value });
                                }
                            },
                            {
                                get: () => config.text_color || defaultConfig.text_color,
                                set: (value) => {
                                    config.text_color = value;
                                    window.elementSdk.setConfig({ text_color: value });
                                }
                            },
                            {
                                get: () => config.primary_color || defaultConfig.primary_color,
                                set: (value) => {
                                    config.primary_color = value;
                                    window.elementSdk.setConfig({ primary_color: value });
                                }
                            },
                            {
                                get: () => config.secondary_color || defaultConfig.secondary_color,
                                set: (value) => {
                                    config.secondary_color = value;
                                    window.elementSdk.setConfig({ secondary_color: value });
                                }
                            }
                        ],
                        borderables: [],
                        fontEditable: {
                            get: () => config.font_family || defaultConfig.font_family,
                            set: (value) => {
                                config.font_family = value;
                                window.elementSdk.setConfig({ font_family: value });
                            }
                        },
                        fontSizeable: {
                            get: () => config.font_size || defaultConfig.font_size,
                            set: (value) => {
                                config.font_size = value;
                                window.elementSdk.setConfig({ font_size: value });
                            }
                        }
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["app_title", config.app_title || defaultConfig.app_title],
                        ["company_tagline", config.company_tagline || defaultConfig.company_tagline],
                        ["shift1_label", config.shift1_label || defaultConfig.shift1_label],
                        ["shift2_label", config.shift2_label || defaultConfig.shift2_label],
                        ["shift3_label", config.shift3_label || defaultConfig.shift3_label]
                    ])
                });
            }

            await render();
        }

        init();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99b71b355498fda6',t:'MTc2MjYyNjI1Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
